{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/env.ts"],"sourcesContent":["import { z } from 'zod';\r\n\r\nconst envSchema = z.object({\r\n  DATABASE_URL: z.string().min(1),\r\n  NEXTAUTH_URL: z.string().url(),\r\n  NEXTAUTH_SECRET: z.string().min(32),\r\n  GOOGLE_CLIENT_ID: z.string().min(1),\r\n  GOOGLE_CLIENT_SECRET: z.string().min(1),\r\n  ADMIN_EMAILS: z.string().default(''),\r\n  ALLOWED_EMAIL_DOMAIN: z.string().default('bhic.org'),\r\n  ETAPESTRY_WSDL_URL: z.string().url(),\r\n  ETAPESTRY_DATABASE_ID: z.string().min(1),\r\n  ETAPESTRY_API_KEY: z.string().min(1),\r\n  ETAPESTRY_LOGIN_ID: z.string().min(1),\r\n  ETAPESTRY_LOGIN_PASSWORD: z.string().min(1),\r\n  ETAPESTRY_APPLICATION_CONTEXT: z.string().default('BHIC Dashboard'),\r\n  ETAPESTRY_QUERY_CATEGORY: z.string().min(1),\r\n  ETAPESTRY_QUERY_NAME: z.string().min(1),\r\n  EVENTBRITE_API_TOKEN: z.string().min(1),\r\n  EVENTBRITE_ORGANIZATION_ID: z.string().min(1),\r\n  GA4_PROPERTY_ID: z.string().min(1),\r\n  GA4_AUTH_MODE: z.enum(['service_account', 'oauth']).default('service_account'),\r\n  GA4_SERVICE_ACCOUNT_JSON: z.string().optional(),\r\n  GA4_OAUTH_CLIENT_ID: z.string().optional(),\r\n  GA4_OAUTH_CLIENT_SECRET: z.string().optional(),\r\n  GA4_OAUTH_REFRESH_TOKEN: z.string().optional(),\r\n  GEMINI_API_KEY: z.string().min(1),\r\n  GEMINI_MODEL: z.string().default('models/gemini-1.5-flash')\r\n});\r\n\r\nconst parsed = envSchema.safeParse({\r\n  DATABASE_URL: process.env.DATABASE_URL,\r\n  NEXTAUTH_URL: process.env.NEXTAUTH_URL,\r\n  NEXTAUTH_SECRET: process.env.NEXTAUTH_SECRET,\r\n  GOOGLE_CLIENT_ID: process.env.GOOGLE_CLIENT_ID,\r\n  GOOGLE_CLIENT_SECRET: process.env.GOOGLE_CLIENT_SECRET,\r\n  ADMIN_EMAILS: process.env.ADMIN_EMAILS ?? '',\r\n  ALLOWED_EMAIL_DOMAIN: process.env.ALLOWED_EMAIL_DOMAIN ?? 'bhic.org',\r\n  ETAPESTRY_WSDL_URL: process.env.ETAPESTRY_WSDL_URL,\r\n  ETAPESTRY_DATABASE_ID: process.env.ETAPESTRY_DATABASE_ID,\r\n  ETAPESTRY_API_KEY: process.env.ETAPESTRY_API_KEY,\r\n  ETAPESTRY_LOGIN_ID: process.env.ETAPESTRY_LOGIN_ID,\r\n  ETAPESTRY_LOGIN_PASSWORD: process.env.ETAPESTRY_LOGIN_PASSWORD,\r\n  ETAPESTRY_APPLICATION_CONTEXT: process.env.ETAPESTRY_APPLICATION_CONTEXT,\r\n  ETAPESTRY_QUERY_CATEGORY: process.env.ETAPESTRY_QUERY_CATEGORY,\r\n  ETAPESTRY_QUERY_NAME: process.env.ETAPESTRY_QUERY_NAME,\r\n  EVENTBRITE_API_TOKEN: process.env.EVENTBRITE_API_TOKEN,\r\n  EVENTBRITE_ORGANIZATION_ID: process.env.EVENTBRITE_ORGANIZATION_ID,\r\n  GA4_PROPERTY_ID: process.env.GA4_PROPERTY_ID,\r\n  GA4_AUTH_MODE: process.env.GA4_AUTH_MODE ?? 'service_account',\r\n  GA4_SERVICE_ACCOUNT_JSON: process.env.GA4_SERVICE_ACCOUNT_JSON,\r\n  GA4_OAUTH_CLIENT_ID: process.env.GA4_OAUTH_CLIENT_ID,\r\n  GA4_OAUTH_CLIENT_SECRET: process.env.GA4_OAUTH_CLIENT_SECRET,\r\n  GA4_OAUTH_REFRESH_TOKEN: process.env.GA4_OAUTH_REFRESH_TOKEN,\r\n  GEMINI_API_KEY: process.env.GEMINI_API_KEY,\r\n  GEMINI_MODEL: process.env.GEMINI_MODEL ?? 'models/gemini-1.5-flash'\r\n});\r\n\r\nif (!parsed.success) {\r\n  console.error('âŒ Invalid environment variables', parsed.error.flatten().fieldErrors);\r\n  throw new Error('Invalid environment variables. Check .env configuration.');\r\n}\r\n\r\nconst data = parsed.data;\r\n\r\nif (data.GA4_AUTH_MODE === 'service_account' && !data.GA4_SERVICE_ACCOUNT_JSON) {\r\n  throw new Error('GA4_SERVICE_ACCOUNT_JSON is required when GA4_AUTH_MODE=service_account');\r\n}\r\n\r\nif (\r\n  data.GA4_AUTH_MODE === 'oauth' &&\r\n  (!data.GA4_OAUTH_CLIENT_ID || !data.GA4_OAUTH_CLIENT_SECRET || !data.GA4_OAUTH_REFRESH_TOKEN)\r\n) {\r\n  throw new Error('GA4 OAuth credentials (client id/secret + refresh token) are required when GA4_AUTH_MODE=oauth');\r\n}\r\n\r\nconst adminEmails = data.ADMIN_EMAILS.split(',').map((email) => email.trim().toLowerCase()).filter(Boolean);\r\n\r\ntype ServiceAccountConfig = { client_email: string; private_key: string };\r\n\r\nexport const env = {\r\n  ...data,\r\n  ADMIN_EMAILS: adminEmails,\r\n  GA4_SERVICE_ACCOUNT: data.GA4_SERVICE_ACCOUNT_JSON\r\n    ? (JSON.parse(data.GA4_SERVICE_ACCOUNT_JSON) as ServiceAccountConfig)\r\n    : null\r\n} as const;\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { withAuth } from 'next-auth/middleware';\r\nimport type { NextRequestWithAuth } from 'next-auth/middleware';\r\n\r\nimport { env } from '@/lib/env';\r\n\r\nconst allowedDomain = env.ALLOWED_EMAIL_DOMAIN.toLowerCase();\r\n\r\nexport default withAuth(\r\n  function middleware(request: NextRequestWithAuth) {\r\n    const token = request.nextauth.token;\r\n    if (!token?.email) {\r\n      return NextResponse.redirect(new URL('/auth/signin', request.url));\r\n    }\r\n\r\n    const [, domain] = token.email.split('@');\r\n    if (!domain || domain.toLowerCase() !== allowedDomain) {\r\n      return NextResponse.redirect(new URL('/auth/not-authorized', request.url));\r\n    }\r\n\r\n    return NextResponse.next();\r\n  },\r\n  {\r\n    callbacks: {\r\n      authorized: ({ token }) => !!token\r\n    }\r\n  }\r\n);\r\n\r\nexport const config = {\r\n  matcher: [\r\n    '/((?!api/auth|auth|_next/static|_next/image|favicon.ico|manifest|robots).*)'\r\n  ]\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAGA;;;;AAEA,MAAM,gBAAgB,gIAAG,CAAC,oBAAoB,CAAC,WAAW;uCAE3C,IAAA,8JAAQ,EACrB,SAAS,WAAW,OAA4B;IAC9C,MAAM,QAAQ,QAAQ,QAAQ,CAAC,KAAK;IACpC,IAAI,CAAC,OAAO,OAAO;QACjB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;IAClE;IAEA,MAAM,GAAG,OAAO,GAAG,MAAM,KAAK,CAAC,KAAK,CAAC;IACrC,IAAI,CAAC,UAAU,OAAO,WAAW,OAAO,eAAe;QACrD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,wBAAwB,QAAQ,GAAG;IAC1E;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B,GACA;IACE,WAAW;QACT,YAAY,CAAC,EAAE,KAAK,EAAE,GAAK,CAAC,CAAC;IAC/B;AACF;AAGK,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}