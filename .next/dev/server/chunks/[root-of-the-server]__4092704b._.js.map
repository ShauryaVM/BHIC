{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var, vars-on-top\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma = global.prisma ?? new PrismaClient({\r\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error']\r\n});\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n  global.prisma = prisma;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SAAS,OAAO,MAAM,IAAI,IAAI,6IAAY,CAAC;IACtD,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEA,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB"}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/env.ts"],"sourcesContent":["import { z } from 'zod';\r\n\r\nconst envSchema = z.object({\r\n  DATABASE_URL: z.string().min(1),\r\n  NEXTAUTH_URL: z.string().url(),\r\n  NEXTAUTH_SECRET: z.string().min(32),\r\n  GOOGLE_CLIENT_ID: z.string().min(1),\r\n  GOOGLE_CLIENT_SECRET: z.string().min(1),\r\n  ADMIN_EMAILS: z.string().default(''),\r\n  ALLOWED_EMAIL_DOMAIN: z.string().default('bhic.org'),\r\n  ETAPESTRY_WSDL_URL: z.string().url(),\r\n  ETAPESTRY_DATABASE_ID: z.string().min(1),\r\n  ETAPESTRY_API_KEY: z.string().min(1),\r\n  ETAPESTRY_QUERY_CATEGORY: z.string().min(1),\r\n  ETAPESTRY_QUERY_NAME: z.string().min(1),\r\n  EVENTBRITE_API_TOKEN: z.string().min(1),\r\n  GA4_PROPERTY_ID: z.string().min(1),\r\n  GA4_AUTH_MODE: z.enum(['service_account', 'oauth']).default('service_account'),\r\n  GA4_SERVICE_ACCOUNT_JSON: z.string().optional(),\r\n  GA4_OAUTH_CLIENT_ID: z.string().optional(),\r\n  GA4_OAUTH_CLIENT_SECRET: z.string().optional(),\r\n  GA4_OAUTH_REFRESH_TOKEN: z.string().optional(),\r\n  GEMINI_API_KEY: z.string().min(1),\r\n  GEMINI_MODEL: z.string().default('models/gemini-1.5-flash')\r\n});\r\n\r\nconst parsed = envSchema.safeParse({\r\n  DATABASE_URL: process.env.DATABASE_URL,\r\n  NEXTAUTH_URL: process.env.NEXTAUTH_URL,\r\n  NEXTAUTH_SECRET: process.env.NEXTAUTH_SECRET,\r\n  GOOGLE_CLIENT_ID: process.env.GOOGLE_CLIENT_ID,\r\n  GOOGLE_CLIENT_SECRET: process.env.GOOGLE_CLIENT_SECRET,\r\n  ADMIN_EMAILS: process.env.ADMIN_EMAILS ?? '',\r\n  ALLOWED_EMAIL_DOMAIN: process.env.ALLOWED_EMAIL_DOMAIN ?? 'bhic.org',\r\n  ETAPESTRY_WSDL_URL: process.env.ETAPESTRY_WSDL_URL,\r\n  ETAPESTRY_DATABASE_ID: process.env.ETAPESTRY_DATABASE_ID,\r\n  ETAPESTRY_API_KEY: process.env.ETAPESTRY_API_KEY,\r\n  ETAPESTRY_QUERY_CATEGORY: process.env.ETAPESTRY_QUERY_CATEGORY,\r\n  ETAPESTRY_QUERY_NAME: process.env.ETAPESTRY_QUERY_NAME,\r\n  EVENTBRITE_API_TOKEN: process.env.EVENTBRITE_API_TOKEN,\r\n  GA4_PROPERTY_ID: process.env.GA4_PROPERTY_ID,\r\n  GA4_AUTH_MODE: process.env.GA4_AUTH_MODE ?? 'service_account',\r\n  GA4_SERVICE_ACCOUNT_JSON: process.env.GA4_SERVICE_ACCOUNT_JSON,\r\n  GA4_OAUTH_CLIENT_ID: process.env.GA4_OAUTH_CLIENT_ID,\r\n  GA4_OAUTH_CLIENT_SECRET: process.env.GA4_OAUTH_CLIENT_SECRET,\r\n  GA4_OAUTH_REFRESH_TOKEN: process.env.GA4_OAUTH_REFRESH_TOKEN,\r\n  GEMINI_API_KEY: process.env.GEMINI_API_KEY,\r\n  GEMINI_MODEL: process.env.GEMINI_MODEL ?? 'models/gemini-1.5-flash'\r\n});\r\n\r\nif (!parsed.success) {\r\n  console.error('âŒ Invalid environment variables', parsed.error.flatten().fieldErrors);\r\n  throw new Error('Invalid environment variables. Check .env configuration.');\r\n}\r\n\r\nconst data = parsed.data;\r\n\r\nif (data.GA4_AUTH_MODE === 'service_account' && !data.GA4_SERVICE_ACCOUNT_JSON) {\r\n  throw new Error('GA4_SERVICE_ACCOUNT_JSON is required when GA4_AUTH_MODE=service_account');\r\n}\r\n\r\nif (\r\n  data.GA4_AUTH_MODE === 'oauth' &&\r\n  (!data.GA4_OAUTH_CLIENT_ID || !data.GA4_OAUTH_CLIENT_SECRET || !data.GA4_OAUTH_REFRESH_TOKEN)\r\n) {\r\n  throw new Error('GA4 OAuth credentials (client id/secret + refresh token) are required when GA4_AUTH_MODE=oauth');\r\n}\r\n\r\nconst adminEmails = data.ADMIN_EMAILS.split(',').map((email) => email.trim().toLowerCase()).filter(Boolean);\r\n\r\ntype ServiceAccountConfig = { client_email: string; private_key: string };\r\n\r\nexport const env = {\r\n  ...data,\r\n  ADMIN_EMAILS: adminEmails,\r\n  GA4_SERVICE_ACCOUNT: data.GA4_SERVICE_ACCOUNT_JSON\r\n    ? (JSON.parse(data.GA4_SERVICE_ACCOUNT_JSON) as ServiceAccountConfig)\r\n    : null\r\n} as const;\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/auth.ts"],"sourcesContent":["import { PrismaAdapter } from '@next-auth/prisma-adapter';\r\nimport type { NextAuthOptions } from 'next-auth';\r\nimport GoogleProvider from 'next-auth/providers/google';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { env } from '@/lib/env';\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n  adapter: PrismaAdapter(prisma),\r\n  providers: [\r\n    GoogleProvider({\r\n      clientId: env.GOOGLE_CLIENT_ID,\r\n      clientSecret: env.GOOGLE_CLIENT_SECRET,\r\n      authorization: {\r\n        params: {\r\n          scope: 'openid email profile https://www.googleapis.com/auth/gmail.send'\r\n        }\r\n      }\r\n    })\r\n  ],\r\n  pages: {\r\n    signIn: '/auth/signin',\r\n    error: '/auth/not-authorized'\r\n  },\r\n  session: {\r\n    strategy: 'jwt'\r\n  },\r\n  callbacks: {\r\n    async signIn({ user }) {\r\n      if (!user.email) {\r\n        return false;\r\n      }\r\n\r\n      const [, domain] = user.email.split('@');\r\n      if (!domain || domain.toLowerCase() !== env.ALLOWED_EMAIL_DOMAIN.toLowerCase()) {\r\n        return '/auth/not-authorized';\r\n      }\r\n\r\n      return true;\r\n    },\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.role = (user as { role?: string }).role ?? token.role ?? 'STAFF';\r\n      }\r\n      return token;\r\n    },\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        session.user.id = token.sub!;\r\n        session.user.role = (token.role as string) ?? 'STAFF';\r\n      }\r\n      return session;\r\n    }\r\n  },\r\n  events: {\r\n    async signIn({ user }) {\r\n      if (!user.email) return;\r\n      const role = env.ADMIN_EMAILS.includes(user.email.toLowerCase()) ? 'ADMIN' : 'STAFF';\r\n      await prisma.user\r\n        .update({\r\n          where: { id: user.id as string },\r\n          data: {\r\n            role,\r\n            lastLoginAt: new Date()\r\n          }\r\n        })\r\n        .catch(() => undefined);\r\n    }\r\n  },\r\n  secret: env.NEXTAUTH_SECRET\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;AAEA;AACA;;;;;AAEO,MAAM,cAA+B;IAC1C,SAAS,IAAA,uLAAa,EAAC,gIAAM;IAC7B,WAAW;QACT,IAAA,gKAAc,EAAC;YACb,UAAU,0HAAG,CAAC,gBAAgB;YAC9B,cAAc,0HAAG,CAAC,oBAAoB;YACtC,eAAe;gBACb,QAAQ;oBACN,OAAO;gBACT;YACF;QACF;KACD;IACD,OAAO;QACL,QAAQ;QACR,OAAO;IACT;IACA,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,MAAM,QAAO,EAAE,IAAI,EAAE;YACnB,IAAI,CAAC,KAAK,KAAK,EAAE;gBACf,OAAO;YACT;YAEA,MAAM,GAAG,OAAO,GAAG,KAAK,KAAK,CAAC,KAAK,CAAC;YACpC,IAAI,CAAC,UAAU,OAAO,WAAW,OAAO,0HAAG,CAAC,oBAAoB,CAAC,WAAW,IAAI;gBAC9E,OAAO;YACT;YAEA,OAAO;QACT;QACA,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,IAAI,GAAG,AAAC,KAA2B,IAAI,IAAI,MAAM,IAAI,IAAI;YACjE;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,GAAG;gBAC3B,QAAQ,IAAI,CAAC,IAAI,GAAG,AAAC,MAAM,IAAI,IAAe;YAChD;YACA,OAAO;QACT;IACF;IACA,QAAQ;QACN,MAAM,QAAO,EAAE,IAAI,EAAE;YACnB,IAAI,CAAC,KAAK,KAAK,EAAE;YACjB,MAAM,OAAO,0HAAG,CAAC,YAAY,CAAC,QAAQ,CAAC,KAAK,KAAK,CAAC,WAAW,MAAM,UAAU;YAC7E,MAAM,gIAAM,CAAC,IAAI,CACd,MAAM,CAAC;gBACN,OAAO;oBAAE,IAAI,KAAK,EAAE;gBAAW;gBAC/B,MAAM;oBACJ;oBACA,aAAa,IAAI;gBACnB;YACF,GACC,KAAK,CAAC,IAAM;QACjB;IACF;IACA,QAAQ,0HAAG,CAAC,eAAe;AAC7B"}},
    {"offset": {"line": 286, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth from 'next-auth';\r\n\r\nimport { authOptions } from '@/lib/auth';\r\n\r\nconst handler = NextAuth(authOptions);\r\n\r\nexport { handler as GET, handler as POST };\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAEA,MAAM,UAAU,IAAA,kJAAQ,EAAC,mIAAW"}}]
}