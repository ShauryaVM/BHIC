{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/components/ui/card.tsx"],"sourcesContent":["import type { ReactNode } from \"react\";\r\nimport clsx from \"clsx\";\r\n\r\ninterface CardProps {\r\n  title?: string;\r\n  description?: string;\r\n  className?: string;\r\n  children: ReactNode;\r\n  actions?: ReactNode;\r\n}\r\n\r\nexport function Card({ title, description, className, children, actions }: CardProps) {\r\n  return (\r\n    <section className={clsx(\"card p-6 space-y-4\", className)}>\r\n      {(title || description || actions) && (\r\n        <header className=\"flex flex-wrap items-center justify-between gap-4\">\r\n          <div>\r\n            {title ? <h3 className=\"text-lg font-semibold text-slate-900\">{title}</h3> : null}\r\n            {description ? <p className=\"text-sm text-slate-500\">{description}</p> : null}\r\n          </div>\r\n          {actions}\r\n        </header>\r\n      )}\r\n      <div>{children}</div>\r\n    </section>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AACA;;;AAUO,SAAS,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,EAAE,OAAO,EAAa;IAClF,qBACE,8OAAC;QAAQ,WAAW,IAAA,gJAAI,EAAC,sBAAsB;;YAC5C,CAAC,SAAS,eAAe,OAAO,mBAC/B,8OAAC;gBAAO,WAAU;;kCAChB,8OAAC;;4BACE,sBAAQ,8OAAC;gCAAG,WAAU;0CAAwC;;;;;uCAAc;4BAC5E,4BAAc,8OAAC;gCAAE,WAAU;0CAA0B;;;;;uCAAmB;;;;;;;oBAE1E;;;;;;;0BAGL,8OAAC;0BAAK;;;;;;;;;;;;AAGZ"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/components/charts/time-series-chart.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TimeSeriesChart = registerClientReference(\n    function() { throw new Error(\"Attempted to call TimeSeriesChart() from the server but TimeSeriesChart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/charts/time-series-chart.tsx <module evaluation>\",\n    \"TimeSeriesChart\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,kBAAkB,IAAA,wQAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,6EACA","ignoreList":[0]}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/components/charts/time-series-chart.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TimeSeriesChart = registerClientReference(\n    function() { throw new Error(\"Attempted to call TimeSeriesChart() from the server but TimeSeriesChart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/charts/time-series-chart.tsx\",\n    \"TimeSeriesChart\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,kBAAkB,IAAA,wQAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,yDACA","ignoreList":[0]}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/cache-metrics.ts"],"sourcesContent":["import { differenceInMinutes } from 'date-fns';\r\nimport type { MetricSource } from '@prisma/client';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\n\r\ninterface CacheParams<T> {\r\n  key: string;\r\n  from: Date;\r\n  to: Date;\r\n  source: MetricSource;\r\n  ttlMinutes?: number;\r\n  fetcher: () => Promise<T>;\r\n}\r\n\r\nlet cacheDisabled = false;\r\n\r\nexport async function withMetricCache<T>({ key, from, to, source, ttlMinutes = 60, fetcher }: CacheParams<T>): Promise<T> {\r\n  if (cacheDisabled) {\r\n    return fetcher();\r\n  }\r\n\r\n  try {\r\n    const existing = await prisma.cachedMetric.findFirst({\r\n      where: { key },\r\n      orderBy: { createdAt: 'desc' }\r\n    });\r\n\r\n    if (existing && differenceInMinutes(new Date(), existing.createdAt) < ttlMinutes) {\r\n      return existing.value as T;\r\n    }\r\n\r\n    const value = await fetcher();\r\n    await prisma.cachedMetric\r\n      .create({\r\n        data: {\r\n          key,\r\n          value,\r\n          fromDate: from,\r\n          toDate: to,\r\n          source\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.warn('Failed to persist cached metric', error instanceof Error ? error.message : error);\r\n      });\r\n\r\n    return value;\r\n  } catch (error) {\r\n    cacheDisabled = true;\r\n    console.warn('Metric cache unavailable, falling back to live fetch', error instanceof Error ? error.message : error);\r\n    return fetcher();\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AAWA,IAAI,gBAAgB;AAEb,eAAe,gBAAmB,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,EAAE,MAAM,EAAE,aAAa,EAAE,EAAE,OAAO,EAAkB;IAC1G,IAAI,eAAe;QACjB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,8HAAM,CAAC,YAAY,CAAC,SAAS,CAAC;YACnD,OAAO;gBAAE;YAAI;YACb,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,IAAI,YAAY,IAAA,yKAAmB,EAAC,IAAI,QAAQ,SAAS,SAAS,IAAI,YAAY;YAChF,OAAO,SAAS,KAAK;QACvB;QAEA,MAAM,QAAQ,MAAM;QACpB,MAAM,8HAAM,CAAC,YAAY,CACtB,MAAM,CAAC;YACN,MAAM;gBACJ;gBACA;gBACA,UAAU;gBACV,QAAQ;gBACR;YACF;QACF,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,IAAI,CAAC,mCAAmC,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC3F;QAEF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,gBAAgB;QAChB,QAAQ,IAAI,CAAC,wDAAwD,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9G,OAAO;IACT;AACF"}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/time-series.ts"],"sourcesContent":["import { format, startOfMonth, endOfMonth, subMonths } from 'date-fns';\r\n\r\nexport interface MonthlyBucket {\r\n  key: string;\r\n  label: string;\r\n  start: Date;\r\n  end: Date;\r\n}\r\n\r\nexport function getMonthlyBuckets(months = 12, anchor: Date = new Date()): MonthlyBucket[] {\r\n  const buckets: MonthlyBucket[] = [];\r\n  const anchorStart = startOfMonth(anchor);\r\n\r\n  for (let i = months - 1; i >= 0; i -= 1) {\r\n    const start = subMonths(anchorStart, i);\r\n    buckets.push({\r\n      key: format(start, 'yyyy-MM'),\r\n      label: format(start, 'MMM yy'),\r\n      start,\r\n      end: endOfMonth(start)\r\n    });\r\n  }\r\n\r\n  return buckets;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AAAA;;AASO,SAAS,kBAAkB,SAAS,EAAE,EAAE,SAAe,IAAI,MAAM;IACtE,MAAM,UAA2B,EAAE;IACnC,MAAM,cAAc,IAAA,2JAAY,EAAC;IAEjC,IAAK,IAAI,IAAI,SAAS,GAAG,KAAK,GAAG,KAAK,EAAG;QACvC,MAAM,QAAQ,IAAA,qJAAS,EAAC,aAAa;QACrC,QAAQ,IAAI,CAAC;YACX,KAAK,IAAA,+JAAM,EAAC,OAAO;YACnB,OAAO,IAAA,+JAAM,EAAC,OAAO;YACrB;YACA,KAAK,IAAA,uJAAU,EAAC;QAClB;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/etapestry.ts"],"sourcesContent":["import { MetricSource, PledgeStatus, Prisma } from '@prisma/client';\r\nimport { subDays } from 'date-fns';\r\nimport { XMLParser } from 'fast-xml-parser';\r\n\r\nimport { withMetricCache } from '@/lib/cache-metrics';\r\nimport { env } from '@/lib/env';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { getMonthlyBuckets } from '@/lib/time-series';\r\n\r\ninterface FetchParams {\r\n  from: Date;\r\n  to: Date;\r\n}\r\n\r\ninterface ExternalPledge {\r\n  id: string;\r\n  amount: number;\r\n  date: string;\r\n  campaign?: string;\r\n  status?: string;\r\n  donor: {\r\n    id?: string;\r\n    externalId?: string;\r\n    name: string;\r\n    email?: string;\r\n    phone?: string;\r\n    lastGiftDate?: string;\r\n  };\r\n}\r\n\r\ntype SoapField = { name?: string; fieldName?: string; value?: unknown };\r\ntype SoapRow = Record<string, unknown> & {\r\n  fieldValues?: SoapField[] | { fieldValue?: SoapField[] };\r\n  values?: SoapField[] | { value?: SoapField[] };\r\n};\r\n\r\nconst allowedStatuses = new Set(Object.values(PledgeStatus));\r\nconst xmlParser = new XMLParser({\r\n  ignoreAttributes: false,\r\n  attributeNamePrefix: '',\r\n  textNodeName: 'text',\r\n  removeNSPrefix: false\r\n});\r\nconst soapEndpoint = (() => {\r\n  try {\r\n    const url = new URL(env.ETAPESTRY_WSDL_URL);\r\n    url.search = '';\r\n    return url.toString();\r\n  } catch {\r\n    return env.ETAPESTRY_WSDL_URL.replace(/\\?wsdl$/i, '').replace(/\\?WSDL$/i, '');\r\n  }\r\n})();\r\nlet sessionPromise: Promise<string> | null = null;\r\n\r\nclass SoapFaultError extends Error {\r\n  faultCode?: string;\r\n  detail?: unknown;\r\n  raw?: string;\r\n}\r\n\r\nclass SoapHttpError extends Error {\r\n  status: number;\r\n  body: string;\r\n\r\n  constructor(message: string, status: number, body: string) {\r\n    super(message);\r\n    this.status = status;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\nfunction escapeXml(value: string) {\r\n  return value\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&apos;');\r\n}\r\n\r\nfunction buildEnvelope(innerBody: string, sessionId?: string) {\r\n  const header = sessionId\r\n    ? `<soap:Header><sessionId xmlns=\"etapestryAPI/service\" xsi:type=\"xsd:string\">${escapeXml(sessionId)}</sessionId></soap:Header>`\r\n    : '<soap:Header/>';\r\n\r\n  return `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:tns=\"etapestryAPI/service\">\r\n  ${header}\r\n  <soap:Body soap:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\">\r\n    ${innerBody}\r\n  </soap:Body>\r\n</soap:Envelope>`;\r\n}\r\n\r\nfunction mapStatus(status?: string | null): PledgeStatus {\r\n  if (!status) return PledgeStatus.PLEDGED;\r\n  const normalized = status.toUpperCase() as PledgeStatus;\r\n  return allowedStatuses.has(normalized) ? normalized : PledgeStatus.PLEDGED;\r\n}\r\n\r\nasync function sendSoapRequest(method: string, innerBody: string, sessionId?: string) {\r\n  const response = await fetch(soapEndpoint, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'text/xml; charset=utf-8',\r\n      SOAPAction: method\r\n    },\r\n    body: buildEnvelope(innerBody, sessionId)\r\n  });\r\n\r\n  const text = await response.text();\r\n\r\n  if (!response.ok) {\r\n    throw new SoapHttpError(`SOAP ${method} failed with status ${response.status}`, response.status, text);\r\n  }\r\n\r\n  const body = parseSoapBody(text);\r\n  return body;\r\n}\r\n\r\nfunction parseSoapBody(xml: string) {\r\n  const document = xmlParser.parse(xml);\r\n  const envelope = document['soap:Envelope'] ?? document['env:Envelope'] ?? document.Envelope;\r\n  if (!envelope) {\r\n    throw new Error('Invalid SOAP response: missing envelope');\r\n  }\r\n\r\n  const body = envelope['soap:Body'] ?? envelope['env:Body'] ?? envelope.Body;\r\n  if (!body) {\r\n    throw new Error('Invalid SOAP response: missing body');\r\n  }\r\n\r\n  const fault = body['soap:Fault'] ?? body['env:Fault'] ?? body.Fault;\r\n  if (fault) {\r\n    const error = new SoapFaultError(fault.faultstring ?? 'SOAP fault');\r\n    error.faultCode = fault.faultcode;\r\n    error.detail = fault.detail;\r\n    error.raw = xml;\r\n    throw error;\r\n  }\r\n\r\n  return body as Record<string, unknown>;\r\n}\r\n\r\nfunction findResponseNode(body: Record<string, unknown>, method: string) {\r\n  const expected = method.endsWith('Response') ? method : `${method}Response`;\r\n  for (const [key, value] of Object.entries(body)) {\r\n    const simpleKey = key.includes(':') ? key.split(':').pop() ?? key : key;\r\n    if (simpleKey === expected) {\r\n      return value as Record<string, unknown>;\r\n    }\r\n  }\r\n  return body;\r\n}\r\n\r\nfunction firstText(node: unknown): string | undefined {\r\n  if (node == null) return undefined;\r\n  if (typeof node === 'string' || typeof node === 'number' || typeof node === 'boolean') {\r\n    return String(node);\r\n  }\r\n  if (Array.isArray(node)) {\r\n    for (const entry of node) {\r\n      const value = firstText(entry);\r\n      if (value) return value;\r\n    }\r\n    return undefined;\r\n  }\r\n  if (typeof node === 'object') {\r\n    for (const value of Object.values(node as Record<string, unknown>)) {\r\n      const result = firstText(value);\r\n      if (result) return result;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction normalizeRecordKeys(record: Record<string, unknown>) {\r\n  const normalized: Record<string, unknown> = {};\r\n\r\n  for (const [key, value] of Object.entries(record)) {\r\n    const simpleKey = key.includes(':') ? key.split(':').pop() ?? key : key;\r\n    if (normalized[simpleKey] === undefined) {\r\n      normalized[simpleKey] = value;\r\n    } else {\r\n      const current = normalized[simpleKey];\r\n      if (Array.isArray(current)) {\r\n        normalized[simpleKey] = current.concat(value);\r\n      } else {\r\n        normalized[simpleKey] = [current, value];\r\n      }\r\n    }\r\n  }\r\n\r\n  return normalized;\r\n}\r\n\r\nasync function getSessionId() {\r\n  if (!sessionPromise) {\r\n    sessionPromise = login();\r\n  }\r\n  return sessionPromise;\r\n}\r\n\r\nasync function login(): Promise<string> {\r\n  try {\r\n    const innerBody = `<tns:connect>\r\n  <ConnectRequest_1 xsi:type=\"tns:ConnectRequest\">\r\n    <applicationContext xmlns=\"\" xsi:type=\"xsd:string\">${escapeXml(env.ETAPESTRY_APPLICATION_CONTEXT)}</applicationContext>\r\n    <databaseId xmlns=\"\" xsi:type=\"xsd:string\">${escapeXml(env.ETAPESTRY_DATABASE_ID)}</databaseId>\r\n    <password xmlns=\"\" xsi:type=\"xsd:string\">${escapeXml(env.ETAPESTRY_API_KEY)}</password>\r\n  </ConnectRequest_1>\r\n</tns:connect>`;\r\n\r\n    const body = await sendSoapRequest('connect', innerBody);\r\n    const responseNode = findResponseNode(body, 'connectResponse');\r\n    const sessionId = firstText(responseNode);\r\n\r\n    if (!sessionId) {\r\n      throw new Error('eTapestry connect did not return a session id.');\r\n    }\r\n\r\n    return sessionId;\r\n  } catch (error) {\r\n    sessionPromise = null;\r\n    console.error('Failed to authenticate with eTapestry', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction invalidateSession() {\r\n  sessionPromise = null;\r\n}\r\n\r\nfunction pledgeSyncRange(range?: Partial<FetchParams>): FetchParams {\r\n  const now = new Date();\r\n  return {\r\n    from: range?.from ?? subDays(now, 90),\r\n    to: range?.to ?? now\r\n  };\r\n}\r\n\r\nasync function fetchQueryRows(start: number, count: number): Promise<SoapRow[]> {\r\n  const sessionId = await getSessionId();\r\n  const queryString = `${env.ETAPESTRY_QUERY_CATEGORY}:${env.ETAPESTRY_QUERY_NAME}`;\r\n\r\n  const innerBody = `<tns:getExistingQueryResults>\r\n  <PagedExistingQueryResultsRequest_1 xsi:type=\"tns:PagedExistingQueryResultsRequest\">\r\n    <clearCache xmlns=\"\" xsi:type=\"xsd:boolean\">false</clearCache>\r\n    <count xmlns=\"\" xsi:type=\"xsd:int\">${count}</count>\r\n    <start xmlns=\"\" xsi:type=\"xsd:int\">${start}</start>\r\n    <accountType xmlns=\"\" xsi:type=\"xsd:int\">0</accountType>\r\n    <query xmlns=\"\" xsi:type=\"xsd:string\">${escapeXml(queryString)}</query>\r\n    <sortOptions xmlns=\"\" xsi:nil=\"true\" />\r\n  </PagedExistingQueryResultsRequest_1>\r\n</tns:getExistingQueryResults>`;\r\n\r\n  try {\r\n    const body = await sendSoapRequest('getExistingQueryResults', innerBody, sessionId);\r\n    const responseNode = findResponseNode(body, 'getExistingQueryResultsResponse');\r\n    const resultNode = (responseNode as Record<string, unknown>)?.result ?? responseNode;\r\n\r\n    if (!resultNode || typeof resultNode !== 'object') {\r\n      return [];\r\n    }\r\n\r\n    return extractRows(resultNode as Record<string, unknown>);\r\n  } catch (error) {\r\n    if (error instanceof SoapFaultError && error.faultCode?.toLowerCase().includes('session')) {\r\n      invalidateSession();\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction getFieldCollection(entry?: SoapField[] | { fieldValue?: SoapField[] } | { value?: SoapField[] }) {\r\n  if (!entry) return [];\r\n  if (Array.isArray(entry)) return entry;\r\n  if (typeof entry === 'object' && entry !== null) {\r\n    if ('fieldValue' in entry && Array.isArray(entry.fieldValue)) return entry.fieldValue;\r\n    if ('value' in entry && Array.isArray(entry.value)) return entry.value;\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction normalizePrimitive(value: unknown): string | undefined {\r\n  if (value == null) return undefined;\r\n  if (typeof value === 'string' || typeof value === 'number') {\r\n    return String(value);\r\n  }\r\n  if (typeof value === 'object' && value !== null && 'value' in (value as Record<string, unknown>)) {\r\n    return normalizePrimitive((value as Record<string, unknown>).value);\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction resolveField(row: SoapRow, candidates: string[]): string | undefined {\r\n  const target = candidates.map((candidate) => candidate.toLowerCase());\r\n\r\n  for (const [key, value] of Object.entries(row)) {\r\n    if (target.includes(key.toLowerCase())) {\r\n      const primitive = normalizePrimitive(value);\r\n      if (primitive) return primitive;\r\n    }\r\n  }\r\n\r\n  for (const collection of [row.fieldValues, row.values]) {\r\n    const entries = getFieldCollection(collection);\r\n    for (const entry of entries) {\r\n      const key = entry.name ?? entry.fieldName;\r\n      if (key && target.includes(key.toLowerCase())) {\r\n        const primitive = normalizePrimitive(entry.value);\r\n        if (primitive) return primitive;\r\n      }\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\nfunction parseCurrency(value?: string) {\r\n  if (!value) return undefined;\r\n  const normalized = value.replace(/[^0-9.-]/g, '');\r\n  const amount = Number(normalized);\r\n  return Number.isNaN(amount) ? undefined : amount;\r\n}\r\n\r\nfunction parseDateValue(value?: string) {\r\n  if (!value) return undefined;\r\n  const parsed = new Date(value);\r\n  if (Number.isNaN(parsed.getTime())) return undefined;\r\n  return parsed;\r\n}\r\n\r\nfunction mapSoapRowToPledge(row: SoapRow): ExternalPledge | null {\r\n  const id = resolveField(row, ['id', 'pledgeid', 'ref', 'accountref']);\r\n  const amount = parseCurrency(resolveField(row, ['amount', 'pledgeamount', 'giftamount']));\r\n  const date = parseDateValue(resolveField(row, ['date', 'pledgedate', 'giftdate', 'entrydate']));\r\n\r\n  if (!id || amount == null || !date) {\r\n    return null;\r\n  }\r\n\r\n  const donorName = resolveField(row, ['donorname', 'name', 'accountname']) ?? 'BHIC donor';\r\n  const donorExternalId = resolveField(row, ['donorid', 'accountnumber', 'constituentid']);\r\n  const donorEmail = resolveField(row, ['email', 'emailaddress', 'primaryemail']);\r\n  const donorPhone = resolveField(row, ['phone', 'phonenumber']);\r\n  const lastGiftDate = parseDateValue(resolveField(row, ['lastgiftdate', 'lastgivingdate']));\r\n  const campaign = resolveField(row, ['campaign', 'fund', 'appeal']);\r\n  const status = resolveField(row, ['status', 'pledgestatus']);\r\n\r\n  return {\r\n    id,\r\n    amount,\r\n    date: date.toISOString(),\r\n    campaign: campaign ?? undefined,\r\n    status: status ?? undefined,\r\n    donor: {\r\n      externalId: donorExternalId ?? undefined,\r\n      name: donorName,\r\n      email: donorEmail ?? undefined,\r\n      phone: donorPhone ?? undefined,\r\n      lastGiftDate: lastGiftDate ? lastGiftDate.toISOString() : undefined\r\n    }\r\n  };\r\n}\r\n\r\nfunction extractRows(payload: unknown): SoapRow[] {\r\n  if (!payload) return [];\r\n  if (Array.isArray(payload)) {\r\n    return payload.filter((item): item is SoapRow => typeof item === 'object' && item !== null);\r\n  }\r\n  if (typeof payload !== 'object') return [];\r\n  const record = normalizeRecordKeys(payload as Record<string, unknown>);\r\n\r\n  const candidates = ['queryResults', 'rows', 'row', 'return', 'value', 'results', 'data', 'collection', 'item', 'items'];\r\n  for (const key of candidates) {\r\n    const nested = record[key];\r\n    if (Array.isArray(nested)) {\r\n      return nested.filter((item): item is SoapRow => typeof item === 'object' && item !== null);\r\n    }\r\n    if (nested && typeof nested === 'object') {\r\n      const rows = extractRows(nested);\r\n      if (rows.length) {\r\n        return rows;\r\n      }\r\n    }\r\n  }\r\n\r\n  return [];\r\n}\r\n\r\nexport async function fetchPledges(range: FetchParams): Promise<ExternalPledge[]> {\r\n  const pageSize = 500;\r\n  let start = 0;\r\n  const collected: ExternalPledge[] = [];\r\n\r\n  while (start < 5000) {\r\n    const rows = await fetchQueryRows(start, pageSize);\r\n    const pledges = rows\r\n      .map((row) => mapSoapRowToPledge(row))\r\n      .filter((pledge): pledge is ExternalPledge => Boolean(pledge));\r\n\r\n    collected.push(...pledges);\r\n\r\n    if (rows.length < pageSize) {\r\n      break;\r\n    }\r\n\r\n    start += pageSize;\r\n  }\r\n\r\n  return collected.filter((pledge) => {\r\n    const date = new Date(pledge.date);\r\n    return date >= range.from && date <= range.to;\r\n  });\r\n}\r\n\r\nexport async function syncPledgesToDb(range?: Partial<FetchParams>) {\r\n  const window = pledgeSyncRange(range);\r\n  const pledges = await fetchPledges(window);\r\n\r\n  for (const pledge of pledges) {\r\n    const donorExternalId = pledge.donor.externalId ?? pledge.donor.id ?? `etp-${pledge.donor.email ?? pledge.id}`;\r\n    const donor = await prisma.donor.upsert({\r\n      where: { externalId: donorExternalId },\r\n      update: {\r\n        name: pledge.donor.name,\r\n        email: pledge.donor.email,\r\n        phone: pledge.donor.phone\r\n      },\r\n      create: {\r\n        externalId: donorExternalId,\r\n        name: pledge.donor.name,\r\n        email: pledge.donor.email,\r\n        phone: pledge.donor.phone\r\n      }\r\n    });\r\n\r\n    await prisma.pledge.upsert({\r\n      where: { externalId: pledge.id },\r\n      update: {\r\n        donorId: donor.id,\r\n        amount: pledge.amount,\r\n        date: new Date(pledge.date),\r\n        campaign: pledge.campaign,\r\n        status: mapStatus(pledge.status)\r\n      },\r\n      create: {\r\n        externalId: pledge.id,\r\n        donorId: donor.id,\r\n        amount: pledge.amount,\r\n        date: new Date(pledge.date),\r\n        campaign: pledge.campaign,\r\n        status: mapStatus(pledge.status)\r\n      }\r\n    });\r\n  }\r\n\r\n  await refreshLifetimeValues();\r\n\r\n  return { synced: pledges.length };\r\n}\r\n\r\nasync function refreshLifetimeValues() {\r\n  const pledged = await prisma.pledge.groupBy({\r\n    by: ['donorId'],\r\n    _sum: { amount: true }\r\n  });\r\n\r\n  const received = await prisma.pledge.groupBy({\r\n    by: ['donorId'],\r\n    where: { status: PledgeStatus.RECEIVED },\r\n    _sum: { amount: true }\r\n  });\r\n\r\n  const receivedMap = new Map(received.map((item) => [item.donorId, item._sum.amount ?? new Prisma.Decimal(0)]));\r\n\r\n  const recentGifts = await prisma.pledge.findMany({\r\n    where: { status: PledgeStatus.RECEIVED },\r\n    select: { donorId: true, date: true },\r\n    orderBy: { date: 'desc' }\r\n  });\r\n\r\n  const lastGiftMap = new Map<string, Date>();\r\n  for (const gift of recentGifts) {\r\n    if (!lastGiftMap.has(gift.donorId)) {\r\n      lastGiftMap.set(gift.donorId, gift.date);\r\n    }\r\n  }\r\n\r\n  for (const donor of pledged) {\r\n    await prisma.donor.update({\r\n      where: { id: donor.donorId },\r\n      data: {\r\n        totalPledged: donor._sum.amount ?? new Prisma.Decimal(0),\r\n        totalGiven: receivedMap.get(donor.donorId) ?? new Prisma.Decimal(0),\r\n        lastGiftDate: lastGiftMap.get(donor.donorId)\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport async function getFundsRaisedSummary(range: FetchParams) {\r\n  return withMetricCache({\r\n    key: `funds:${range.from.toISOString()}:${range.to.toISOString()}`,\r\n    from: range.from,\r\n    to: range.to,\r\n    source: MetricSource.ETAPESTRY,\r\n    fetcher: async () => {\r\n      const pledges = await prisma.pledge.findMany({\r\n        where: { date: { gte: range.from, lte: range.to } },\r\n        select: { amount: true, date: true }\r\n      });\r\n\r\n      const buckets = getMonthlyBuckets(12, range.to);\r\n      const series = buckets.map((bucket) => {\r\n        const total = pledges\r\n          .filter((pledge) => pledge.date >= bucket.start && pledge.date <= bucket.end)\r\n          .reduce((sum, pledge) => sum + Number(pledge.amount), 0);\r\n        return { label: bucket.label, total };\r\n      });\r\n\r\n      const totalYtd = pledges.reduce((sum, pledge) => sum + Number(pledge.amount), 0);\r\n      return {\r\n        total: totalYtd,\r\n        monthly: series\r\n      };\r\n    }\r\n  });\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 730, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/eventbrite.ts"],"sourcesContent":["import { EventStatus, MetricSource } from '@prisma/client';\r\nimport { addDays, subDays } from 'date-fns';\r\n\r\nimport { withMetricCache } from '@/lib/cache-metrics';\r\nimport { env } from '@/lib/env';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\ninterface FetchParams {\r\n  from: Date;\r\n  to: Date;\r\n}\r\n\r\ninterface EventbriteName {\r\n  text?: string;\r\n}\r\n\r\ninterface EventbriteDateInfo {\r\n  utc: string;\r\n}\r\n\r\ninterface EventbriteVenue {\r\n  name?: string;\r\n}\r\n\r\ninterface EventbriteTicketAvailability {\r\n  capacity?: number;\r\n}\r\n\r\ninterface EventbritePagination {\r\n  has_more_items?: boolean;\r\n  page_number?: number;\r\n  page_count?: number;\r\n  continuation?: string | null;\r\n}\r\n\r\ninterface EventbriteEvent {\r\n  id: string;\r\n  name?: EventbriteName;\r\n  start: EventbriteDateInfo;\r\n  end: EventbriteDateInfo;\r\n  status?: string;\r\n  venue?: EventbriteVenue;\r\n  ticket_availability?: EventbriteTicketAvailability;\r\n}\r\n\r\ninterface EventbriteAttendee {\r\n  id: string;\r\n  profile: {\r\n    name?: string;\r\n    first_name?: string;\r\n    last_name?: string;\r\n    email?: string;\r\n  };\r\n  quantity?: number;\r\n  cost?: {\r\n    major_value?: string;\r\n  };\r\n  ticket_class_name?: string;\r\n}\r\n\r\ninterface EventbriteEventsResponse {\r\n  events?: EventbriteEvent[];\r\n  pagination?: EventbritePagination;\r\n}\r\n\r\ninterface EventbriteAttendeesResponse {\r\n  attendees?: EventbriteAttendee[];\r\n  pagination?: EventbritePagination;\r\n}\r\n\r\nconst API_BASE = 'https://www.eventbriteapi.com/v3';\r\n\r\nfunction withAuthHeaders() {\r\n  return {\r\n    Authorization: `Bearer ${env.EVENTBRITE_API_TOKEN}`,\r\n    'Content-Type': 'application/json'\r\n  };\r\n}\r\n\r\nfunction rangeWithDefault(range?: Partial<FetchParams>): FetchParams {\r\n  const now = new Date();\r\n  return {\r\n    from: range?.from ?? subDays(now, 120),\r\n    to: range?.to ?? addDays(now, 30)\r\n  };\r\n}\r\n\r\nfunction mapStatus(status?: string): EventStatus {\r\n  switch (status?.toLowerCase()) {\r\n    case 'live':\r\n      return EventStatus.PUBLISHED;\r\n    case 'completed':\r\n      return EventStatus.COMPLETED;\r\n    case 'canceled':\r\n      return EventStatus.CANCELLED;\r\n    default:\r\n      return EventStatus.DRAFT;\r\n  }\r\n}\r\n\r\nasync function fetchEventAttendees(eventId: string): Promise<EventbriteAttendee[]> {\r\n  const attendees: EventbriteAttendee[] = [];\r\n  let continuation: string | undefined;\r\n  let page = 1;\r\n\r\n  while (true) {\r\n    const url = new URL(`/events/${eventId}/attendees/`, API_BASE);\r\n    url.searchParams.set('status', 'attending');\r\n    url.searchParams.set('expand', 'profile');\r\n    if (continuation) {\r\n      url.searchParams.set('continuation', continuation);\r\n    } else {\r\n      url.searchParams.set('page', String(page));\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      headers: withAuthHeaders(),\r\n      cache: 'no-store'\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to fetch attendees for ${eventId}: ${response.statusText}`);\r\n    }\r\n\r\n    const body = (await response.json()) as EventbriteAttendeesResponse;\r\n    attendees.push(...(body.attendees ?? []));\r\n\r\n    const pagination = body.pagination;\r\n    if (pagination?.has_more_items) {\r\n      if (pagination.continuation) {\r\n        continuation = pagination.continuation;\r\n      } else {\r\n        continuation = undefined;\r\n        page += 1;\r\n      }\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return attendees;\r\n}\r\n\r\nexport async function fetchEvents(range: FetchParams): Promise<Array<EventbriteEvent & { attendees: EventbriteAttendee[] }>> {\r\n  const events: EventbriteEvent[] = [];\r\n  let continuation: string | undefined;\r\n  let page = 1;\r\n\r\n  while (true) {\r\n    const url = new URL(`/organizations/${env.EVENTBRITE_ORGANIZATION_ID}/events/`, API_BASE);\r\n    url.searchParams.set('order_by', 'start_desc');\r\n    url.searchParams.set('time_filter', 'custom');\r\n    url.searchParams.set('start_date.range_start', range.from.toISOString());\r\n    url.searchParams.set('start_date.range_end', range.to.toISOString());\r\n    url.searchParams.set('expand', 'ticket_availability,venue');\r\n    url.searchParams.set('page_size', '50');\r\n    if (continuation) {\r\n      url.searchParams.set('continuation', continuation);\r\n    } else {\r\n      url.searchParams.set('page', String(page));\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      headers: withAuthHeaders(),\r\n      cache: 'no-store'\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to fetch Eventbrite events: ${response.statusText}`);\r\n    }\r\n\r\n    const data = (await response.json()) as EventbriteEventsResponse;\r\n    events.push(...(data.events ?? []));\r\n\r\n    const pagination = data.pagination;\r\n    if (pagination?.has_more_items) {\r\n      if (pagination.continuation) {\r\n        continuation = pagination.continuation;\r\n      } else {\r\n        continuation = undefined;\r\n        page += 1;\r\n      }\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n\r\n  const withAttendees = await Promise.all(\r\n    events.map(async (event) => ({\r\n      ...event,\r\n      attendees: await fetchEventAttendees(event.id)\r\n    }))\r\n  );\r\n\r\n  return withAttendees;\r\n}\r\n\r\nexport async function syncEventsToDb(range?: Partial<FetchParams>) {\r\n  const window = rangeWithDefault(range);\r\n  const events = await fetchEvents(window);\r\n\r\n  for (const event of events) {\r\n    const base = await prisma.event.upsert({\r\n      where: { externalId: event.id },\r\n      update: {\r\n        name: event.name?.text ?? 'Untitled Event',\r\n        startDate: new Date(event.start.utc),\r\n        endDate: new Date(event.end.utc ?? event.start.utc),\r\n        venue: event.venue?.name,\r\n        status: mapStatus(event.status),\r\n        ticketsTotal: event.ticket_availability?.capacity ?? 0\r\n      },\r\n      create: {\r\n        externalId: event.id,\r\n        name: event.name?.text ?? 'Untitled Event',\r\n        startDate: new Date(event.start.utc),\r\n        endDate: new Date(event.end.utc ?? event.start.utc),\r\n        venue: event.venue?.name,\r\n        status: mapStatus(event.status),\r\n        ticketsTotal: event.ticket_availability?.capacity ?? 0\r\n      }\r\n    });\r\n\r\n    await prisma.eventAttendance.deleteMany({ where: { eventId: base.id } });\r\n\r\n    let ticketsSold = 0;\r\n    let grossRevenue = 0;\r\n\r\n    const attendancePayload = [];\r\n\r\n    for (const attendee of event.attendees) {\r\n      const email = attendee.profile?.email;\r\n      if (!email) continue;\r\n      const ticketsCount = attendee.quantity ?? 1;\r\n      const orderTotal = Number(attendee.cost?.major_value ?? 0);\r\n      ticketsSold += ticketsCount;\r\n      grossRevenue += orderTotal;\r\n\r\n      const donor = await prisma.donor.findUnique({ where: { email } });\r\n\r\n      attendancePayload.push({\r\n        eventId: base.id,\r\n        donorId: donor?.id ?? null,\r\n        attendeeEmail: email,\r\n        ticketType: attendee.ticket_class_name ?? 'General',\r\n        ticketsCount,\r\n        orderTotal\r\n      });\r\n    }\r\n\r\n    if (attendancePayload.length) {\r\n      await prisma.eventAttendance.createMany({ data: attendancePayload });\r\n    }\r\n\r\n    await prisma.event.update({\r\n      where: { id: base.id },\r\n      data: {\r\n        ticketsSold,\r\n        grossRevenue,\r\n        netRevenue: grossRevenue * 0.88\r\n      }\r\n    });\r\n  }\r\n\r\n  return { synced: events.length };\r\n}\r\n\r\nexport async function getEventKpis(range: FetchParams) {\r\n  return withMetricCache({\r\n    key: `events:${range.from.toISOString()}:${range.to.toISOString()}`,\r\n    from: range.from,\r\n    to: range.to,\r\n    source: MetricSource.EVENTBRITE,\r\n    fetcher: async () => {\r\n      const events = await prisma.event.findMany({\r\n        where: {\r\n          startDate: { gte: range.from, lte: range.to }\r\n        }\r\n      });\r\n\r\n      const eventsCount = events.length;\r\n      const ticketsSold = events.reduce((sum, event) => sum + event.ticketsSold, 0);\r\n      const grossRevenue = events.reduce((sum, event) => sum + Number(event.grossRevenue), 0);\r\n      const netRevenue = events.reduce((sum, event) => sum + Number(event.netRevenue), 0);\r\n\r\n      return {\r\n        eventsCount,\r\n        ticketsSold,\r\n        grossRevenue,\r\n        netRevenue\r\n      };\r\n    }\r\n  });\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1016, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/ga4.ts"],"sourcesContent":["import { BetaAnalyticsDataClient } from '@google-analytics/data';\r\nimport { OAuth2Client } from 'google-auth-library';\r\nimport { MetricSource } from '@prisma/client';\r\nimport { format } from 'date-fns';\r\n\r\nimport { withMetricCache } from '@/lib/cache-metrics';\r\nimport { env } from '@/lib/env';\r\n\r\nlet client: BetaAnalyticsDataClient | null = null;\r\nlet oauthClient: OAuth2Client | null = null;\r\n\r\nfunction getOAuthClient() {\r\n  if (oauthClient) {\r\n    return oauthClient;\r\n  }\r\n\r\n  oauthClient = new OAuth2Client(env.GA4_OAUTH_CLIENT_ID, env.GA4_OAUTH_CLIENT_SECRET);\r\n  oauthClient.setCredentials({ refresh_token: env.GA4_OAUTH_REFRESH_TOKEN });\r\n\r\n  return oauthClient;\r\n}\r\n\r\nfunction normalizePrivateKey(key: string) {\r\n  return key.includes('\\\\n') ? key.replace(/\\\\n/g, '\\n') : key;\r\n}\r\n\r\nfunction getClient() {\r\n  if (client) {\r\n    return client;\r\n  }\r\n\r\n  if (env.GA4_AUTH_MODE === 'oauth') {\r\n    client = new BetaAnalyticsDataClient({\r\n      authClient: getOAuthClient()\r\n    });\r\n  } else {\r\n    if (!env.GA4_SERVICE_ACCOUNT) {\r\n      throw new Error('GA4 service account credentials missing');\r\n    }\r\n\r\n    client = new BetaAnalyticsDataClient({\r\n      credentials: {\r\n        client_email: env.GA4_SERVICE_ACCOUNT.client_email,\r\n        private_key: normalizePrivateKey(env.GA4_SERVICE_ACCOUNT.private_key)\r\n      }\r\n    });\r\n  }\r\n\r\n  return client;\r\n}\r\n\r\nconst property = `properties/${env.GA4_PROPERTY_ID}`;\r\n\r\nfunction iso(date: Date) {\r\n  return format(date, 'yyyy-MM-dd');\r\n}\r\n\r\ninterface BaseRange {\r\n  from: Date;\r\n  to: Date;\r\n}\r\n\r\nexport interface Ga4SeriesPoint {\r\n  label: string;\r\n  value: number;\r\n  date: string;\r\n}\r\n\r\nexport interface Ga4SeriesResponse {\r\n  points: Ga4SeriesPoint[];\r\n}\r\n\r\nexport interface Ga4TopPage {\r\n  path: string;\r\n  title: string;\r\n  pageviews: number;\r\n}\r\n\r\nexport interface Ga4SummaryResponse {\r\n  users: number;\r\n  sessions: number;\r\n  pageviews: number;\r\n  averageEngagementTime: number;\r\n  error?: string;\r\n}\r\n\r\nasync function fetchSessionsSeries(params: BaseRange & { granularity: 'DAILY' | 'MONTHLY' }): Promise<Ga4SeriesResponse> {\r\n  const dimensionName = params.granularity === 'MONTHLY' ? 'yearMonth' : 'date';\r\n  const response = await getClient().runReport({\r\n    property,\r\n    dateRanges: [{ startDate: iso(params.from), endDate: iso(params.to) }],\r\n    dimensions: [{ name: dimensionName }],\r\n    metrics: [{ name: 'sessions' }],\r\n    orderBys: [{ dimension: { dimensionName } }]\r\n  });\r\n\r\n  const points: Ga4SeriesPoint[] =\r\n    response[0]?.rows?.map((row) => {\r\n      const raw = row.dimensionValues?.[0]?.value ?? '';\r\n      let label = raw;\r\n      let dateValue = raw;\r\n      if (params.granularity === 'MONTHLY' && raw.length === 6) {\r\n        const year = Number(raw.slice(0, 4));\r\n        const month = Number(raw.slice(4, 6)) - 1;\r\n        const dt = new Date(Date.UTC(year, month, 1));\r\n        label = format(dt, 'MMM yy');\r\n        dateValue = dt.toISOString();\r\n      } else if (params.granularity === 'DAILY' && raw.length === 8) {\r\n        const year = Number(raw.slice(0, 4));\r\n        const month = Number(raw.slice(4, 6)) - 1;\r\n        const day = Number(raw.slice(6, 8));\r\n        const dt = new Date(Date.UTC(year, month, day));\r\n        label = format(dt, 'MMM d');\r\n        dateValue = dt.toISOString();\r\n      }\r\n\r\n      const value = Number(row.metricValues?.[0]?.value ?? 0);\r\n      return { label, value, date: dateValue };\r\n    }) ?? [];\r\n\r\n  return { points };\r\n}\r\n\r\nexport async function getSessionsOverTime(range: BaseRange & { granularity?: 'DAILY' | 'MONTHLY' }): Promise<Ga4SeriesResponse & { error?: string }> {\r\n  try {\r\n    return await withMetricCache({\r\n      key: `ga4:sessions:${range.granularity ?? 'DAILY'}:${iso(range.from)}:${iso(range.to)}`,\r\n      from: range.from,\r\n      to: range.to,\r\n      source: MetricSource.GA4,\r\n      fetcher: () =>\r\n        fetchSessionsSeries({\r\n          granularity: range.granularity ?? 'DAILY',\r\n          from: range.from,\r\n          to: range.to\r\n        })\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to fetch GA4 sessions', error);\r\n    return {\r\n      points: [],\r\n      error: 'Unable to load Google Analytics sessions right now.'\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getTopPages(range: BaseRange, limit = 8): Promise<{ rows: Ga4TopPage[]; error?: string }> {\r\n  try {\r\n    const response = await getClient().runReport({\r\n      property,\r\n      dateRanges: [{ startDate: iso(range.from), endDate: iso(range.to) }],\r\n      dimensions: [{ name: 'pagePathPlusQueryString' }, { name: 'pageTitle' }],\r\n      metrics: [{ name: 'screenPageViews' }],\r\n      orderBys: [{ metric: { metricName: 'screenPageViews' }, desc: true }],\r\n      limit\r\n    });\r\n\r\n    const rows: Ga4TopPage[] =\r\n      response[0]?.rows?.map((row) => ({\r\n        path: row.dimensionValues?.[0]?.value ?? 'N/A',\r\n        title: row.dimensionValues?.[1]?.value ?? 'Untitled page',\r\n        pageviews: Number(row.metricValues?.[0]?.value ?? 0)\r\n      })) ?? [];\r\n\r\n    return { rows };\r\n  } catch (error) {\r\n    console.error('Failed to fetch GA4 top pages', error);\r\n    return { rows: [], error: 'Unable to load top page data.' };\r\n  }\r\n}\r\n\r\nexport async function getSummaryMetrics(range: BaseRange): Promise<Ga4SummaryResponse> {\r\n  try {\r\n    const response = await getClient().runReport({\r\n      property,\r\n      dateRanges: [{ startDate: iso(range.from), endDate: iso(range.to) }],\r\n      metrics: [\r\n        { name: 'totalUsers' },\r\n        { name: 'sessions' },\r\n        { name: 'screenPageViews' },\r\n        { name: 'averageSessionDuration' }\r\n      ]\r\n    });\r\n\r\n    const metrics = response[0]?.rows?.[0]?.metricValues ?? [];\r\n    const users = Number(metrics[0]?.value ?? 0);\r\n    const sessions = Number(metrics[1]?.value ?? 0);\r\n    const pageviews = Number(metrics[2]?.value ?? 0);\r\n    const averageEngagementTime = Number(metrics[3]?.value ?? 0);\r\n\r\n    return {\r\n      users,\r\n      sessions,\r\n      pageviews,\r\n      averageEngagementTime\r\n    };\r\n  } catch (error) {\r\n    console.error('Failed to fetch GA4 summary metrics', error);\r\n    return {\r\n      users: 0,\r\n      sessions: 0,\r\n      pageviews: 0,\r\n      averageEngagementTime: 0,\r\n      error: 'Unable to load Google Analytics metrics.'\r\n    };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1254, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/dashboard-data.ts"],"sourcesContent":["import { PledgeStatus, Prisma } from '@prisma/client';\r\nimport { startOfMonth, startOfYear, subDays, subMonths } from 'date-fns';\r\n\r\nimport { getFundsRaisedSummary } from '@/lib/etapestry';\r\nimport { getEventKpis } from '@/lib/eventbrite';\r\nimport { getSessionsOverTime, getSummaryMetrics } from '@/lib/ga4';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { getMonthlyBuckets } from '@/lib/time-series';\r\n\r\nconst toNumber = (value?: Prisma.Decimal | null) => Number(value ?? 0);\r\n\r\nexport interface DashboardSeriesPoint {\r\n  label: string;\r\n  funds: number;\r\n  tickets: number;\r\n  sessions: number;\r\n}\r\n\r\nexport interface DashboardData {\r\n  kpis: {\r\n    fundsYtd: number;\r\n    totalDonors: number;\r\n    activeDonors: number;\r\n    eventsThisYear: number;\r\n    ticketsSold: number;\r\n    sessionsLast30Days: number;\r\n    gaError?: string;\r\n  };\r\n  charts: {\r\n    monthly: DashboardSeriesPoint[];\r\n  };\r\n}\r\n\r\nexport async function getDashboardData(range: 'ytd' | '12m' = 'ytd'): Promise<DashboardData> {\r\n  const now = new Date();\r\n  const summaryStart = range === '12m' ? subMonths(startOfMonth(now), 11) : startOfYear(now);\r\n  const monthlyStart = subMonths(startOfMonth(now), 11);\r\n  const monthlyRange = { from: monthlyStart, to: now };\r\n  const last30Start = subDays(now, 30);\r\n\r\n  try {\r\n    const [fundsSummary, fundsYtdAggregate, totalDonors, activeDonors, eventKpis, gaSummary, gaSessions, attendance] = await Promise.all([\r\n      getFundsRaisedSummary(monthlyRange),\r\n      prisma.pledge.aggregate({\r\n        where: {\r\n          date: { gte: summaryStart, lte: now },\r\n          status: { in: [PledgeStatus.PLEDGED, PledgeStatus.RECEIVED] }\r\n        },\r\n        _sum: { amount: true }\r\n      }),\r\n      prisma.donor.count(),\r\n      prisma.donor.count({\r\n        where: { lastGiftDate: { gte: subDays(now, 365) } }\r\n      }),\r\n      getEventKpis({ from: summaryStart, to: now }),\r\n      getSummaryMetrics({ from: last30Start, to: now }),\r\n      getSessionsOverTime({ from: monthlyStart, to: now, granularity: 'MONTHLY' }),\r\n      prisma.eventAttendance.findMany({\r\n        where: { createdAt: { gte: monthlyStart, lte: now } },\r\n        select: { ticketsCount: true, createdAt: true }\r\n      })\r\n    ]);\r\n\r\n    const sessionsMap = new Map(gaSessions.points.map((point) => [point.label, point.value]));\r\n    const fundsMap = new Map(fundsSummary.monthly.map((point) => [point.label, point.total]));\r\n    const monthlyBuckets = getMonthlyBuckets(12, now);\r\n\r\n    const monthlySeries = monthlyBuckets.map((bucket) => {\r\n      const tickets = attendance\r\n        .filter((entry) => entry.createdAt >= bucket.start && entry.createdAt <= bucket.end)\r\n        .reduce((sum, entry) => sum + entry.ticketsCount, 0);\r\n\r\n      return {\r\n        label: bucket.label,\r\n        funds: fundsMap.get(bucket.label) ?? 0,\r\n        tickets,\r\n        sessions: sessionsMap.get(bucket.label) ?? 0\r\n      };\r\n    });\r\n\r\n    return {\r\n      kpis: {\r\n        fundsYtd: toNumber(fundsYtdAggregate._sum.amount),\r\n        totalDonors,\r\n        activeDonors,\r\n        eventsThisYear: eventKpis.eventsCount,\r\n        ticketsSold: eventKpis.ticketsSold,\r\n        sessionsLast30Days: gaSummary.sessions,\r\n        gaError: gaSummary.error\r\n      },\r\n      charts: {\r\n        monthly: monthlySeries\r\n      }\r\n    };\r\n  } catch (error) {\r\n    console.error('Failed to load dashboard data', error);\r\n    return buildFallbackDashboardData(now);\r\n  }\r\n}\r\n\r\nfunction buildFallbackDashboardData(anchor: Date): DashboardData {\r\n  const buckets = getMonthlyBuckets(12, anchor);\r\n  return {\r\n    kpis: {\r\n      fundsYtd: 0,\r\n      totalDonors: 0,\r\n      activeDonors: 0,\r\n      eventsThisYear: 0,\r\n      ticketsSold: 0,\r\n      sessionsLast30Days: 0,\r\n      gaError: 'Metrics temporarily unavailable. Check data sources.'\r\n    },\r\n    charts: {\r\n      monthly: buckets.map((bucket) => ({\r\n        label: bucket.label,\r\n        funds: 0,\r\n        tickets: 0,\r\n        sessions: 0\r\n      }))\r\n    }\r\n  };\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1402, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/lib/format.ts"],"sourcesContent":["export function formatCurrency(value: number, currency = 'USD', maximumFractionDigits = 0) {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency,\r\n    maximumFractionDigits\r\n  }).format(value);\r\n}\r\n\r\nexport function formatNumber(value: number, maximumFractionDigits = 0) {\r\n  return new Intl.NumberFormat('en-US', {\r\n    maximumFractionDigits\r\n  }).format(value);\r\n}\r\n\r\nexport function formatPercent(value: number, maximumFractionDigits = 1) {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'percent',\r\n    maximumFractionDigits\r\n  }).format(value);\r\n}\r\n\r\nexport function formatDate(date: Date | string, options: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric', year: 'numeric' }) {\r\n  const dt = typeof date === 'string' ? new Date(date) : date;\r\n  return new Intl.DateTimeFormat('en-US', options).format(dt);\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAO,SAAS,eAAe,KAAa,EAAE,WAAW,KAAK,EAAE,wBAAwB,CAAC;IACvF,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC,OAAO;QACP;QACA;IACF,GAAG,MAAM,CAAC;AACZ;AAEO,SAAS,aAAa,KAAa,EAAE,wBAAwB,CAAC;IACnE,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC;IACF,GAAG,MAAM,CAAC;AACZ;AAEO,SAAS,cAAc,KAAa,EAAE,wBAAwB,CAAC;IACpE,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC,OAAO;QACP;IACF,GAAG,MAAM,CAAC;AACZ;AAEO,SAAS,WAAW,IAAmB,EAAE,UAAsC;IAAE,OAAO;IAAS,KAAK;IAAW,MAAM;AAAU,CAAC;IACvI,MAAM,KAAK,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACvD,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS,SAAS,MAAM,CAAC;AAC1D"}},
    {"offset": {"line": 1442, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/components/layout/page-header.tsx"],"sourcesContent":["import type { ReactNode } from \"react\";\r\nimport clsx from \"clsx\";\r\n\r\ninterface PageHeaderProps {\r\n  eyebrow?: string;\r\n  title: string;\r\n  description?: string;\r\n  actions?: ReactNode;\r\n  children?: ReactNode;\r\n  className?: string;\r\n}\r\n\r\nexport function PageHeader({ eyebrow, title, description, actions, children, className }: PageHeaderProps) {\r\n  return (\r\n    <section\r\n      className={clsx(\r\n        \"relative overflow-hidden rounded-[32px] border border-white/60 bg-white/80 p-6 shadow-[0px_25px_60px_rgba(15,23,42,0.08)] backdrop-blur\",\r\n        className\r\n      )}\r\n    >\r\n      <div className=\"pointer-events-none absolute inset-0\">\r\n        <div className=\"absolute -top-16 -right-8 h-48 w-48 rounded-full bg-brand/15 blur-3xl\" />\r\n        <div className=\"absolute bottom-[-60px] left-[-40px] h-44 w-44 rounded-full bg-accent/10 blur-3xl\" />\r\n      </div>\r\n      <div className=\"relative z-10 flex flex-wrap items-start gap-6\">\r\n        <div className=\"space-y-3\">\r\n          {eyebrow ? (\r\n            <span className=\"inline-flex items-center rounded-full border border-slate-100/70 bg-slate-50/80 px-3 py-1 text-xs font-semibold uppercase tracking-[0.16em] text-slate-500\">\r\n              {eyebrow}\r\n            </span>\r\n          ) : null}\r\n          <div>\r\n            <h1 className=\"text-3xl font-semibold leading-tight text-slate-900\">{title}</h1>\r\n            {description ? <p className=\"mt-2 max-w-3xl text-sm text-slate-600\">{description}</p> : null}\r\n          </div>\r\n        </div>\r\n        {actions ? <div className=\"ml-auto flex flex-col items-stretch gap-3\">{actions}</div> : null}\r\n      </div>\r\n      {children ? <div className=\"relative z-10 mt-6\">{children}</div> : null}\r\n    </section>\r\n  );\r\n}\r\n\r\ninterface PageHeaderMetaProps {\r\n  items: Array<{\r\n    label: string;\r\n    value: string;\r\n    helper?: string;\r\n  }>;\r\n  columns?: number;\r\n}\r\n\r\nexport function PageHeaderMeta({ items, columns = 3 }: PageHeaderMetaProps) {\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        \"grid gap-4 text-sm text-slate-600\",\r\n        columns === 2 ? \"sm:grid-cols-2\" : columns === 4 ? \"sm:grid-cols-2 lg:grid-cols-4\" : \"sm:grid-cols-3\"\r\n      )}\r\n    >\r\n      {items.map((item) => (\r\n        <div\r\n          key={`${item.label}-${item.value}`}\r\n          className=\"rounded-2xl border border-slate-100/70 bg-white/90 px-4 py-3 shadow-inner shadow-slate-200/70\"\r\n        >\r\n          <p className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">{item.label}</p>\r\n          <p className=\"mt-1 text-base font-semibold text-slate-900\">{item.value}</p>\r\n          {item.helper ? <p className=\"mt-0.5 text-xs text-slate-500\">{item.helper}</p> : null}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;AACA;;;AAWO,SAAS,WAAW,EAAE,OAAO,EAAE,KAAK,EAAE,WAAW,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAmB;IACvG,qBACE,8OAAC;QACC,WAAW,IAAA,gJAAI,EACb,2IACA;;0BAGF,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAI,WAAU;;;;;;;;;;;;0BAEjB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;4BACZ,wBACC,8OAAC;gCAAK,WAAU;0CACb;;;;;uCAED;0CACJ,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAuD;;;;;;oCACpE,4BAAc,8OAAC;wCAAE,WAAU;kDAAyC;;;;;+CAAmB;;;;;;;;;;;;;oBAG3F,wBAAU,8OAAC;wBAAI,WAAU;kCAA6C;;;;;+BAAiB;;;;;;;YAEzF,yBAAW,8OAAC;gBAAI,WAAU;0BAAsB;;;;;uBAAkB;;;;;;;AAGzE;AAWO,SAAS,eAAe,EAAE,KAAK,EAAE,UAAU,CAAC,EAAuB;IACxE,qBACE,8OAAC;QACC,WAAW,IAAA,gJAAI,EACb,qCACA,YAAY,IAAI,mBAAmB,YAAY,IAAI,kCAAkC;kBAGtF,MAAM,GAAG,CAAC,CAAC,qBACV,8OAAC;gBAEC,WAAU;;kCAEV,8OAAC;wBAAE,WAAU;kCAAgE,KAAK,KAAK;;;;;;kCACvF,8OAAC;wBAAE,WAAU;kCAA+C,KAAK,KAAK;;;;;;oBACrE,KAAK,MAAM,iBAAG,8OAAC;wBAAE,WAAU;kCAAiC,KAAK,MAAM;;;;;+BAAQ;;eAL3E,GAAG,KAAK,KAAK,CAAC,CAAC,EAAE,KAAK,KAAK,EAAE;;;;;;;;;;AAU5C"}},
    {"offset": {"line": 1598, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/app/%28dashboard%29/range-selector.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DashboardRangeSelector = registerClientReference(\n    function() { throw new Error(\"Attempted to call DashboardRangeSelector() from the server but DashboardRangeSelector is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/range-selector.tsx <module evaluation>\",\n    \"DashboardRangeSelector\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,yBAAyB,IAAA,wQAAuB,EACzD;IAAa,MAAM,IAAI,MAAM;AAA4P,GACzR,wEACA","ignoreList":[0]}},
    {"offset": {"line": 1612, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/app/%28dashboard%29/range-selector.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DashboardRangeSelector = registerClientReference(\n    function() { throw new Error(\"Attempted to call DashboardRangeSelector() from the server but DashboardRangeSelector is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/range-selector.tsx\",\n    \"DashboardRangeSelector\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,yBAAyB,IAAA,wQAAuB,EACzD;IAAa,MAAM,IAAI,MAAM;AAA4P,GACzR,oDACA","ignoreList":[0]}},
    {"offset": {"line": 1626, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 1634, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shaurya/Documents/GitHub/BHIC/src/app/%28dashboard%29/page.tsx"],"sourcesContent":["import { Coins, Globe, Ticket, Users2 } from 'lucide-react';\r\n\r\nimport { Card } from '@/components/ui/card';\r\nimport { TimeSeriesChart } from '@/components/charts/time-series-chart';\r\nimport { getDashboardData } from '@/lib/dashboard-data';\r\nimport { formatCurrency, formatNumber } from '@/lib/format';\r\nimport { PageHeader, PageHeaderMeta } from '@/components/layout/page-header';\r\n\r\nimport { DashboardRangeSelector } from '@/app/(dashboard)/range-selector';\r\n\r\ninterface DashboardPageProps {\r\n  searchParams: Promise<{\r\n    range?: string | string[];\r\n  }>;\r\n}\r\n\r\nexport default async function DashboardPage({ searchParams }: DashboardPageProps) {\r\n  const params = await searchParams;\r\n  const rawRange = Array.isArray(params?.range) ? params?.range[0] : params?.range;\r\n  const range = rawRange === '12m' ? '12m' : 'ytd';\r\n  const data = await getDashboardData(range);\r\n\r\n  return (\r\n    <div className=\"space-y-10\">\r\n      <PageHeader\r\n        eyebrow=\"Executive view\"\r\n        title=\"Mission Control\"\r\n        description=\"Funds, community engagement, and digital reach in one place.\"\r\n        actions={<DashboardRangeSelector currentRange={range} />}\r\n      >\r\n        <PageHeaderMeta\r\n          items={[\r\n            {\r\n              label: 'Current range',\r\n              value: range === '12m' ? 'Last 12 months' : 'Year to date'\r\n            },\r\n            {\r\n              label: 'Data sources',\r\n              value: 'eTapestry  Eventbrite  GA4',\r\n              helper: 'Synced securely via service accounts'\r\n            },\r\n            {\r\n              label: 'Refresh cadence',\r\n              value: 'Every 60 minutes',\r\n              helper: 'Automatic background sync'\r\n            }\r\n          ]}\r\n        />\r\n      </PageHeader>\r\n\r\n      <section className=\"grid gap-4 md:grid-cols-2 xl:grid-cols-4\">\r\n        <Card className=\"space-y-3 bg-gradient-to-br from-brand/10 via-white to-white\">\r\n          <div className=\"flex items-center justify-between text-xs uppercase tracking-widest text-slate-500\">\r\n            <span>Funds raised ({range === '12m' ? '12 months' : 'YTD'})</span>\r\n            <Coins className=\"h-5 w-5 text-brand\" />\r\n          </div>\r\n          <p className=\"text-4xl font-semibold text-slate-900\">{formatCurrency(data.kpis.fundsYtd)}</p>\r\n          <p className=\"text-xs text-slate-500\">Includes pledges received and committed.</p>\r\n        </Card>\r\n        <Card className=\"space-y-3 bg-gradient-to-br from-slate-50 via-white to-white\">\r\n          <div className=\"flex items-center justify-between text-xs uppercase tracking-widest text-slate-500\">\r\n            <span>Active donors</span>\r\n            <Users2 className=\"h-5 w-5 text-brand-light\" />\r\n          </div>\r\n          <p className=\"text-4xl font-semibold text-slate-900\">{formatNumber(data.kpis.activeDonors)}</p>\r\n          <p className=\"text-xs text-slate-500\">Last gift within the past 12 months.</p>\r\n        </Card>\r\n        <Card className=\"space-y-3 bg-gradient-to-br from-white via-slate-50 to-white\">\r\n          <div className=\"flex items-center justify-between text-xs uppercase tracking-widest text-slate-500\">\r\n            <span>Events + tickets</span>\r\n            <Ticket className=\"h-5 w-5 text-brand\" />\r\n          </div>\r\n          <p className=\"text-4xl font-semibold text-slate-900\">\r\n            {formatNumber(data.kpis.eventsThisYear)} <span className=\"text-base text-slate-500\">events</span>\r\n          </p>\r\n          <p className=\"text-sm font-semibold text-slate-800\">{formatNumber(data.kpis.ticketsSold)} tickets sold</p>\r\n        </Card>\r\n        <Card className=\"space-y-3 bg-gradient-to-br from-white via-white to-slate-50\">\r\n          <div className=\"flex items-center justify-between text-xs uppercase tracking-widest text-slate-500\">\r\n            <span>Website sessions (30d)</span>\r\n            <Globe className=\"h-5 w-5 text-brand-light\" />\r\n          </div>\r\n          <p className=\"text-4xl font-semibold text-slate-900\">{formatNumber(data.kpis.sessionsLast30Days)}</p>\r\n          {data.kpis.gaError ? (\r\n            <p className=\"text-xs text-red-500\">{data.kpis.gaError}</p>\r\n          ) : (\r\n            <p className=\"text-xs text-slate-500\">Source: Google Analytics 4</p>\r\n          )}\r\n        </Card>\r\n      </section>\r\n\r\n      <Card title=\"Performance trends\" description=\"Funds, ticketing, and sessions across the last 12 months\">\r\n        <TimeSeriesChart\r\n          data={data.charts.monthly}\r\n          lines={[\r\n            { dataKey: 'funds', color: '#0f172a', name: 'Funds raised', strokeWidth: 3 },\r\n            { dataKey: 'tickets', color: '#f97316', name: 'Tickets sold', strokeWidth: 3 },\r\n            { dataKey: 'sessions', color: '#2563eb', name: 'Sessions', strokeWidth: 3 }\r\n          ]}\r\n        />\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}