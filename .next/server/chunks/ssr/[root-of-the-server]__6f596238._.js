module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},50645,a=>{a.n(a.i(27572))},43619,a=>{a.n(a.i(79962))},13718,a=>{a.n(a.i(85523))},18198,a=>{a.n(a.i(45518))},62212,a=>{a.n(a.i(66114))},70844,a=>{a.n(a.i(92359))},46786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},48344,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call BarChartComponent() from the server but BarChartComponent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/charts/bar-chart.tsx <module evaluation>","BarChartComponent");a.s(["BarChartComponent",0,b])},93003,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call BarChartComponent() from the server but BarChartComponent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/charts/bar-chart.tsx","BarChartComponent");a.s(["BarChartComponent",0,b])},9170,a=>{"use strict";a.i(48344);var b=a.i(93003);a.n(b)},23529,a=>{"use strict";var b=a.i(10236),c=a.i(48461),d=a.i(31290),e=a.i(66518);async function f(a={}){let b=function(a){if(!a.from&&!a.to)return{};let b={};return(a.from||a.to)&&(b.startDate={...a.from?{gte:a.from}:{},...a.to?{lte:a.to}:{}}),b}(a);try{let a=(await e.prisma.event.findMany({where:b,orderBy:{startDate:"desc"}})).map(a=>{let b,c;return{...a,grossRevenue:(b=a.grossRevenue,Number(b??0)),netRevenue:(c=a.netRevenue,Number(c??0))}}),c=new Date,d=a.filter(a=>a.startDate>=c).length,f=a.length-d,g=a.reduce((a,b)=>a+b.ticketsSold,0),h=a.reduce((a,b)=>a+Number(b.grossRevenue??0),0),i=a.reduce((a,b)=>a+Number(b.netRevenue??0),0);return{events:a,summary:{upcomingEvents:d,pastEvents:f,ticketsSold:g,grossRevenue:h,netRevenue:i},charts:{ticketsPerEvent:a.map(a=>({name:a.name,tickets:a.ticketsSold})),revenuePerEvent:a.map(a=>({name:a.name,gross:Number(a.grossRevenue??0),net:Number(a.netRevenue??0)}))}}}catch(a){return console.warn("Unable to load events data, returning empty snapshot",a instanceof Error?a.message:a),{events:[],summary:{upcomingEvents:0,pastEvents:0,ticketsSold:0,grossRevenue:0,netRevenue:0},charts:{ticketsPerEvent:[],revenuePerEvent:[]}}}}function g(){return{from:(0,d.subDays)((0,c.startOfDay)(new Date),90),to:(0,b.addDays)((0,c.startOfDay)(new Date),180)}}a.s(["defaultEventFilters",()=>g,"getEventsData",()=>f])},92924,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call PieChartComponent() from the server but PieChartComponent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/charts/pie-chart.tsx <module evaluation>","PieChartComponent");a.s(["PieChartComponent",0,b])},30270,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call PieChartComponent() from the server but PieChartComponent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/charts/pie-chart.tsx","PieChartComponent");a.s(["PieChartComponent",0,b])},37069,a=>{"use strict";a.i(92924);var b=a.i(30270);a.n(b)},55703,a=>{"use strict";var b=a.i(95805),c=a.i(31290),d=a.i(7950),e=a.i(66518),f=a.i(65314);async function g(a){let{page:g,pageSize:h,query:i,minTotalGiven:j,lastGiftFrom:k,lastGiftTo:l}=a,m={},n=[{name:"< $1k",min:0,max:1e3},{name:"$1k - $5k",min:1e3,max:5e3},{name:"$5k - $10k",min:5e3,max:1e4},{name:"$10k+",min:1e4,max:1/0}],o=(0,f.getMonthlyBuckets)(12);i&&(m.OR=[{name:{contains:i,mode:"insensitive"}},{email:{contains:i,mode:"insensitive"}}]),j&&(m.totalGiven={gte:j}),(k||l)&&(m.lastGiftDate={},k&&(m.lastGiftDate.gte=k),l&&(m.lastGiftDate.lte=l));try{let a,[f,i,j,k,l,p,q]=await Promise.all([e.prisma.donor.count({where:m}),e.prisma.donor.findMany({where:m,orderBy:{totalGiven:"desc"},take:h,skip:(g-1)*h,select:{id:!0,name:!0,email:!0,phone:!0,totalGiven:!0,totalPledged:!0,lastGiftDate:!0}}),e.prisma.donor.count(),e.prisma.donor.count({where:{lastGiftDate:{gte:(0,c.subDays)(new Date,365)}}}),e.prisma.donor.aggregate({_avg:{totalGiven:!0}}),e.prisma.donor.findMany({where:{createdAt:{gte:(0,d.subMonths)((0,b.startOfMonth)(new Date),11)}},select:{createdAt:!0}}),e.prisma.donor.findMany({select:{totalGiven:!0}})]),r=i.map(a=>{let b,c;return{...a,totalGiven:(b=a.totalGiven,Number(b??0)),totalPledged:(c=a.totalPledged,Number(c??0))}}),s=o.map(a=>({label:a.label,value:p.filter(b=>b.createdAt>=a.start&&b.createdAt<=a.end).length})),t=n.map(a=>({name:a.name,value:q.filter(b=>{let c,d=(c=b.totalGiven,Number(c??0));return d>=a.min&&d<a.max}).length}));return{donors:r,pagination:{page:g,pageSize:h,total:f,totalPages:Math.max(1,Math.ceil(f/h))},summary:{totalDonors:j,activeDonors:k,averageLifetimeValue:(a=l._avg.totalGiven,Number(a??0))},charts:{acquisitions:s,giftDistribution:t}}}catch(a){return console.error("Failed to load donor list data. Serving fallback dataset.",a),function({page:a,pageSize:b,acquisitionBuckets:c,giftRanges:d}){return{donors:[],pagination:{page:a,pageSize:b,total:0,totalPages:1},summary:{totalDonors:0,activeDonors:0,averageLifetimeValue:0},charts:{acquisitions:c.map(a=>({label:a.label,value:0})),giftDistribution:d.map(a=>({name:a.name,value:0}))}}}({page:g,pageSize:h,acquisitionBuckets:o,giftRanges:n})}}a.s(["getDonorList",()=>g])},28954,a=>{"use strict";var b=a.i(96818),c=a.i(99602),d=a.i(66518);let e=!1;async function f({key:a,from:f,to:g,source:h,ttlMinutes:i=60,fetcher:j}){if(e)return j();try{var k,l,m;let e,n=await d.prisma.cachedMetric.findFirst({where:{key:a},orderBy:{createdAt:"desc"}});if(n&&(k=new Date,l=n.createdAt,e=((0,c.toDate)(k)-(0,c.toDate)(l))/b.millisecondsInMinute,(m=void 0,a=>{let b=(m?Math[m]:Math.trunc)(a);return 0===b?0:b})(e)<i))return n.value;let o=await j();return await d.prisma.cachedMetric.create({data:{key:a,value:o,fromDate:f,toDate:g,source:h}}).catch(a=>{console.warn("Failed to persist cached metric",a instanceof Error?a.message:a)}),o}catch(a){return e=!0,console.warn("Metric cache unavailable, falling back to live fetch",a instanceof Error?a.message:a),j()}}a.s(["withMetricCache",()=>f],28954)},7950,a=>{"use strict";var b=a.i(18956),c=a.i(99602);function d(a,d,e){return function(a,d,e){let f=(0,c.toDate)(a,e?.in);if(isNaN(d))return(0,b.constructFrom)(e?.in||a,NaN);if(!d)return f;let g=f.getDate(),h=(0,b.constructFrom)(e?.in||a,f.getTime());return(h.setMonth(f.getMonth()+d+1,0),g>=h.getDate())?h:(f.setFullYear(h.getFullYear(),h.getMonth(),g),f)}(a,-d,e)}a.s(["subMonths",()=>d],7950)},95805,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setDate(1),d.setHours(0,0,0,0),d}a.s(["startOfMonth",()=>c])},98794,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in),e=d.getMonth();return d.setFullYear(d.getFullYear(),e+1,0),d.setHours(23,59,59,999),d}a.s(["endOfMonth",()=>c])},65314,a=>{"use strict";var b=a.i(12208),c=a.i(95805),d=a.i(98794),e=a.i(7950);function f(a=12,g=new Date){let h=[],i=(0,c.startOfMonth)(g);for(let c=a-1;c>=0;c-=1){let a=(0,e.subMonths)(i,c);h.push({key:(0,b.format)(a,"yyyy-MM"),label:(0,b.format)(a,"MMM yy"),start:a,end:(0,d.endOfMonth)(a)})}return h}a.s(["getMonthlyBuckets",()=>f])},35988,a=>{"use strict";var b=a.i(29173),c=a.i(95805),d=a.i(61628),e=a.i(31290),f=a.i(7950),g=a.i(71148),h=a.i(40826),i=a.i(4709),j=a.i(66518),k=a.i(65314);async function l(a="ytd"){let m=new Date,n="12m"===a?(0,f.subMonths)((0,c.startOfMonth)(m),11):(0,d.startOfYear)(m),o=(0,f.subMonths)((0,c.startOfMonth)(m),11),p=(0,e.subDays)(m,30);try{let a,[c,d,f,l,q,r,s,t]=await Promise.all([(0,g.getFundsRaisedSummary)({from:o,to:m}),j.prisma.pledge.aggregate({where:{date:{gte:n,lte:m},status:{in:[b.PledgeStatus.PLEDGED,b.PledgeStatus.RECEIVED]}},_sum:{amount:!0}}),j.prisma.donor.count(),j.prisma.donor.count({where:{lastGiftDate:{gte:(0,e.subDays)(m,365)}}}),(0,h.getEventKpis)({from:n,to:m}),(0,i.getSummaryMetrics)({from:p,to:m}),(0,i.getSessionsOverTime)({from:o,to:m,granularity:"MONTHLY"}),j.prisma.eventAttendance.findMany({where:{createdAt:{gte:o,lte:m}},select:{ticketsCount:!0,createdAt:!0}})]),u=new Map(s.points.map(a=>[a.label,a.value])),v=new Map(c.monthly.map(a=>[a.label,a.total])),w=(0,k.getMonthlyBuckets)(12,m).map(a=>{let b=t.filter(b=>b.createdAt>=a.start&&b.createdAt<=a.end).reduce((a,b)=>a+b.ticketsCount,0);return{label:a.label,funds:v.get(a.label)??0,tickets:b,sessions:u.get(a.label)??0}});return{kpis:{fundsYtd:(a=d._sum.amount,Number(a??0)),totalDonors:f,activeDonors:l,eventsThisYear:q.eventsCount,ticketsSold:q.ticketsSold,sessionsLast30Days:r.sessions,gaError:r.error},charts:{monthly:w}}}catch(a){var q;return console.error("Failed to load dashboard data",a),q=m,{kpis:{fundsYtd:0,totalDonors:0,activeDonors:0,eventsThisYear:0,ticketsSold:0,sessionsLast30Days:0,gaError:"Metrics temporarily unavailable. Check data sources."},charts:{monthly:(0,k.getMonthlyBuckets)(12,q).map(a=>({label:a.label,funds:0,tickets:0,sessions:0}))}}}}a.s(["getDashboardData",()=>l])},45310,a=>{"use strict";var b=a.i(7997),c=a.i(84347);function d({children:a,className:d}){return(0,b.jsx)("table",{className:(0,c.default)("min-w-full divide-y divide-slate-200",d),children:a})}function e({children:a}){return(0,b.jsx)("thead",{className:"bg-slate-50",children:(0,b.jsx)("tr",{className:"text-xs font-semibold uppercase tracking-wider text-slate-500",children:a})})}function f({children:a}){return(0,b.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white text-sm text-slate-700",children:a})}function g({children:a,align:d="left",className:e}){return(0,b.jsx)("th",{scope:"col",className:(0,c.default)("px-4 py-3",{"text-left":"left"===d,"text-center":"center"===d,"text-right":"right"===d},e),children:a})}function h({children:a,align:d="left",className:e}){return(0,b.jsx)("td",{className:(0,c.default)("px-4 py-3",{"text-left":"left"===d,"text-center":"center"===d,"text-right":"right"===d},e),children:a})}a.s(["TBody",()=>f,"TD",()=>h,"TH",()=>g,"THead",()=>e,"Table",()=>d])},48461,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(0,0,0,0),d}a.s(["startOfDay",()=>c])},31290,96818,18956,99602,10236,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}function e(a,b,e){let f=d(a,e?.in);return isNaN(b)?c(e?.in||a,NaN):(b&&f.setDate(f.getDate()+b),f)}function f(a,b,c){return e(a,-b,c)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInMinute",0,6e4,"millisecondsInWeek",0,6048e5],96818),a.s(["constructFrom",()=>c],18956),a.s(["toDate",()=>d],99602),a.s(["addDays",()=>e],10236),a.s(["subDays",()=>f],31290)},35330,84347,14962,a=>{"use strict";var b=a.i(7997);let c=function(){for(var a,b,c=0,d="",e=arguments.length;c<e;c++)(a=arguments[c])&&(b=function a(b){var c,d,e="";if("string"==typeof b||"number"==typeof b)e+=b;else if("object"==typeof b)if(Array.isArray(b)){var f=b.length;for(c=0;c<f;c++)b[c]&&(d=a(b[c]))&&(e&&(e+=" "),e+=d)}else for(d in b)b[d]&&(e&&(e+=" "),e+=d);return e}(a))&&(d&&(d+=" "),d+=b);return d};function d({title:a,description:d,className:e,children:f,actions:g}){return(0,b.jsxs)("section",{className:c("card p-6 space-y-4",e),children:[(a||d||g)&&(0,b.jsxs)("header",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[a?(0,b.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:a}):null,d?(0,b.jsx)("p",{className:"text-sm text-slate-500",children:d}):null]}),g]}),(0,b.jsx)("div",{children:f})]})}function e({eyebrow:a,title:d,description:e,actions:f,children:g,className:h}){return(0,b.jsxs)("section",{className:c("relative overflow-hidden rounded-[32px] border border-white/60 bg-white/80 p-6 shadow-[0px_25px_60px_rgba(15,23,42,0.08)] backdrop-blur",h),children:[(0,b.jsxs)("div",{className:"pointer-events-none absolute inset-0",children:[(0,b.jsx)("div",{className:"absolute -top-16 -right-8 h-48 w-48 rounded-full bg-brand/15 blur-3xl"}),(0,b.jsx)("div",{className:"absolute bottom-[-60px] left-[-40px] h-44 w-44 rounded-full bg-accent/10 blur-3xl"})]}),(0,b.jsxs)("div",{className:"relative z-10 flex flex-wrap items-start gap-6",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[a?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full border border-slate-100/70 bg-slate-50/80 px-3 py-1 text-xs font-semibold uppercase tracking-[0.16em] text-slate-500",children:a}):null,(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold leading-tight text-slate-900",children:d}),e?(0,b.jsx)("p",{className:"mt-2 max-w-3xl text-sm text-slate-600",children:e}):null]})]}),f?(0,b.jsx)("div",{className:"ml-auto flex flex-col items-stretch gap-3",children:f}):null]}),g?(0,b.jsx)("div",{className:"relative z-10 mt-6",children:g}):null]})}function f({items:a,columns:d=3}){return(0,b.jsx)("div",{className:c("grid gap-4 text-sm text-slate-600",2===d?"sm:grid-cols-2":4===d?"sm:grid-cols-2 lg:grid-cols-4":"sm:grid-cols-3"),children:a.map(a=>(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-100/70 bg-white/90 px-4 py-3 shadow-inner shadow-slate-200/70",children:[(0,b.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:a.label}),(0,b.jsx)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:a.value}),a.helper?(0,b.jsx)("p",{className:"mt-0.5 text-xs text-slate-500",children:a.helper}):null]},`${a.label}-${a.value}`))})}a.s(["default",0,c],84347),a.s(["Card",()=>d],35330),a.s(["PageHeader",()=>e,"PageHeaderMeta",()=>f],14962)},43116,a=>{"use strict";function b(a,c="USD",d=0){return new Intl.NumberFormat("en-US",{style:"currency",currency:c,maximumFractionDigits:d}).format(a)}function c(a,b=0){return new Intl.NumberFormat("en-US",{maximumFractionDigits:b}).format(a)}function d(a,b=1){return new Intl.NumberFormat("en-US",{style:"percent",maximumFractionDigits:b}).format(a)}function e(a,b={month:"short",day:"numeric",year:"numeric"}){let c="string"==typeof a?new Date(a):a;return new Intl.DateTimeFormat("en-US",b).format(c)}a.s(["formatCurrency",()=>b,"formatDate",()=>e,"formatNumber",()=>c,"formatPercent",()=>d])},3620,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call TimeSeriesChart() from the server but TimeSeriesChart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/charts/time-series-chart.tsx <module evaluation>","TimeSeriesChart");a.s(["TimeSeriesChart",0,b])},2241,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call TimeSeriesChart() from the server but TimeSeriesChart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/charts/time-series-chart.tsx","TimeSeriesChart");a.s(["TimeSeriesChart",0,b])},58388,a=>{"use strict";a.i(3620);var b=a.i(2241);a.n(b)},78824,a=>{"use strict";var b=a.i(31290),c=a.i(4709);function d(){let a=new Date;return{from:(0,b.subDays)(a,30),to:a}}async function e(a){let[b,d,e]=await Promise.all([(0,c.getSummaryMetrics)(a),(0,c.getSessionsOverTime)({...a,granularity:"DAILY"}),(0,c.getTopPages)(a)]);return{summary:b,sessionsSeries:d,topPages:e}}a.s(["defaultAnalyticsFilters",()=>d,"getAnalyticsData",()=>e])},85685,a=>{a.v(a=>Promise.resolve().then(()=>a(54799)))},6179,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_tty_33e910c0._.js","server/chunks/ssr/node_modules_9b06bcf1._.js"].map(b=>a.l(b))).then(()=>b(48081)))},90407,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__9eaab4c4._.js","server/chunks/ssr/node_modules_df13f179._.js","server/chunks/ssr/node_modules_node-fetch_src_index_3793b177.js"].map(b=>a.l(b))).then(()=>b(25659)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6f596238._.js.map