module.exports=[86616,23061,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(20971);a.i(70396);var e=a.i(73727),f=a.i(53112),g=a.i(9307),h=a.i(66518),i=a.i(54799);let j=a.i(92665).env.SETTINGS_ENCRYPTION_KEY_BUFFER,k="aes-256-gcm",l=[{key:"EVENTBRITE_API_TOKEN",label:"Eventbrite API Token",description:"Personal OAuth token used for syncing events.",type:"text"},{key:"EVENTBRITE_ORGANIZATION_ID",label:"Eventbrite Organization ID",description:"Organization identifier for event syncs.",type:"text"},{key:"ETAPESTRY_API_KEY",label:"eTapestry API Key",description:"API key for SOAP integration.",type:"text"},{key:"ETAPESTRY_LOGIN_ID",label:"eTapestry Login ID",description:"Username used with the API key.",type:"text"},{key:"ETAPESTRY_LOGIN_PASSWORD",label:"eTapestry Login Password",description:"Password paired with the login ID.",type:"text"},{key:"GA4_SERVICE_ACCOUNT_JSON",label:"GA4 Service Account JSON",description:"Full JSON credentials for the GA4 Data API.",type:"textarea",placeholder:'{ "type": "service_account", ... }'},{key:"GEMINI_API_KEY",label:"Gemini API Key",description:"Used for AI drafting.",type:"text"}];async function m(){let a=l.map(a=>a.key),b=new Map((await h.prisma.secureSetting.findMany({where:{key:{in:a}},include:{updatedBy:!0}})).map(a=>[a.key,a]));return l.map(a=>{let c=b.get(a.key),d=null;if(c)try{var e;let a,b,f,g,h,l=(e=c.encryptedValue,b=(a=Buffer.from(e,"base64")).subarray(0,12),f=a.subarray(12,28),g=a.subarray(28),(h=i.default.createDecipheriv(k,j,b)).setAuthTag(f),Buffer.concat([h.update(g),h.final()]).toString("utf8"));d=l.length>8?`•••• ${l.slice(-4)}`:"••••"}catch{d="Unable to decrypt"}return{...a,updatedAt:c?.updatedAt??null,updatedBy:c?.updatedBy?.email??c?.updatedBy?.name??null,hasValue:!!c,preview:d}})}async function n(a){var b;let c,d,e,f;if(!l.find(b=>b.key===a.key))throw Error(`Unknown setting ${a.key}`);let g=(b=a.value,c=i.default.randomBytes(12),d=i.default.createCipheriv(k,j,c),e=Buffer.concat([d.update(b,"utf8"),d.final()]),f=d.getAuthTag(),Buffer.concat([c,f,e]).toString("base64")),m=await h.prisma.secureSetting.upsert({where:{key:a.key},update:{encryptedValue:g,updatedById:a.userId??null},create:{key:a.key,encryptedValue:g,updatedById:a.userId??null}});await h.prisma.secureSettingHistory.create({data:{key:a.key,encryptedValue:g,settingId:m.id,updatedById:a.userId??null}})}a.s(["INTEGRATION_SETTING_DEFINITIONS",0,l,"listSecureSettings",()=>m,"upsertSecureSetting",()=>n],23061);var o=a.i(13095);let p=f.z.object({key:f.z.string().min(1),value:f.z.string().min(1)}),q=f.z.object({userId:f.z.string().cuid(),role:f.z.enum(["ADMIN","STAFF"])});async function r(){let a=await (0,d.getServerSession)(g.authOptions);return a||(0,e.redirect)("/auth/signin"),"ADMIN"!==a.user.role&&(0,e.redirect)("/"),a}async function s(a){let b=await r(),d=p.safeParse({key:a.get("key"),value:a.get("value")});if(!d.success)throw Error("Invalid setting payload.");await n({key:d.data.key,value:d.data.value,userId:b.user.id}),(0,c.revalidatePath)("/settings")}async function t(a){let b=await r(),d=q.safeParse({userId:a.get("userId"),role:a.get("role")});if(!d.success)throw Error("Invalid user payload.");if(d.data.userId===b.user.id&&"ADMIN"!==d.data.role)throw Error("You cannot downgrade your own role.");await h.prisma.user.update({where:{id:d.data.userId},data:{role:d.data.role}}),(0,c.revalidatePath)("/settings")}(0,o.ensureServerEntryExports)([s,t]),(0,b.registerServerReference)(s,"40528bc0fff7d1ed92663858d39c9bea6e2044ac3d",null),(0,b.registerServerReference)(t,"40a6b5841ea69c11e128d9d7c2b7503f5bfac58021",null),a.s(["updateSecureSettingAction",()=>s,"updateUserRoleAction",()=>t],86616)},36846,a=>{"use strict";var b=a.i(86616);a.s([],16806),a.i(16806),a.s(["40528bc0fff7d1ed92663858d39c9bea6e2044ac3d",()=>b.updateSecureSettingAction,"40a6b5841ea69c11e128d9d7c2b7503f5bfac58021",()=>b.updateUserRoleAction],36846)}];

//# sourceMappingURL=_66584ff4._.js.map