module.exports=[80050,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call InsightsReportButton() from the server but InsightsReportButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/(dashboard)/insights/_components/insights-report-button.tsx <module evaluation>","InsightsReportButton");a.s(["InsightsReportButton",0,b])},78617,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call InsightsReportButton() from the server but InsightsReportButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/(dashboard)/insights/_components/insights-report-button.tsx","InsightsReportButton");a.s(["InsightsReportButton",0,b])},31699,a=>{"use strict";a.i(80050);var b=a.i(78617);a.n(b)},98696,a=>{"use strict";var b=a.i(7997),c=a.i(35330),d=a.i(45310),e=a.i(14962),f=a.i(58388),g=a.i(9170),h=a.i(37069),i=a.i(43116),j=a.i(7950),k=a.i(35988),l=a.i(23529),m=a.i(78824),n=a.i(55703),o=a.i(14355);function p(a,b){return Number.isFinite(a)&&Number.isFinite(b)&&0!==b?(a-b)/Math.abs(b):0}function q(a,b){if(!a.length||b<=0)return 0;let c=a.slice(-b);return c.length?c.reduce((a,b)=>a+b,0)/c.length:0}function r(a,b,c,d){return a>.05?"positive":a<-.05?"negative":"neutral"}async function s(){var a;let b=new Date,c={from:(0,j.subMonths)(b,11),to:b},d=(0,l.defaultEventFilters)(),e=(0,m.defaultAnalyticsFilters)(),[f,g,h,i,s]=await Promise.all([(0,k.getDashboardData)("12m"),(0,n.getDonorList)({page:1,pageSize:5}),(0,l.getEventsData)(d),(0,m.getAnalyticsData)(e),(0,o.getIntegrationStatuses)()]),t=s.etapestry&&!(0,o.isIntegrationStale)(s.etapestry),u=s.eventbrite&&!(0,o.isIntegrationStale)(s.eventbrite),v=function(a,{includeEtapestry:b,includeEventbrite:c}){let d=a.charts.monthly.map(a=>({...a})),e={...a.kpis};return b||(e.fundsYtd=0,e.totalDonors=0,e.activeDonors=0,d=d.map(a=>({...a,funds:0}))),c||(e.eventsThisYear=0,e.ticketsSold=0,d=d.map(a=>({...a,tickets:0}))),{kpis:e,charts:{monthly:d}}}(f,{includeEtapestry:!!t,includeEventbrite:!!u}),w=t?g:{donors:[],pagination:{...(a=g).pagination,total:0,totalPages:1},summary:{totalDonors:0,activeDonors:0,averageLifetimeValue:0},charts:{acquisitions:a.charts.acquisitions.map(a=>({...a,value:0})),giftDistribution:a.charts.giftDistribution.map(a=>({...a,value:0}))}},x=u?h:{events:[],summary:{upcomingEvents:0,pastEvents:0,ticketsSold:0,grossRevenue:0,netRevenue:0},charts:{ticketsPerEvent:[],revenuePerEvent:[]}},y=function(a){if(a.length<4)return 0;let b=a.map(a=>a.funds);return p(q(b,3),q(b.slice(0,-3),3))}(v.charts.monthly),z=function(a){if(a.length<14)return 0;let b=a.map(a=>a.value);return p(q(b.slice(-7),7),q(b.slice(-14,-7),7))}(i.sessionsSeries.points),A=function(a){let b=a.filter(a=>a.ticketsTotal>0);if(!b.length)return 0;let c=b.reduce((a,b)=>a+b.ticketsTotal,0),d=b.reduce((a,b)=>a+b.ticketsSold,0);return 0===c?0:d/c}(x.events),B=x.events.slice().sort((a,b)=>b.grossRevenue-a.grossRevenue)[0],C=i.topPages.rows[0],D=w.donors[0],E=function(a){let b=[];if(b.push({title:"Giving momentum",description:a.fundsMomentum>.05?"Monthly funds raised increased compared to the prior quarter.":a.fundsMomentum<-.05?"Funds raised dipped versus the prior quarter—consider a donor re-engagement push.":"Giving volume is steady when compared to the previous quarter.",impact:r(a.fundsMomentum,"positive","negative","neutral")}),b.push({title:"Digital engagement",description:a.sessionsMomentum>.05?"Website sessions grew over the last two weeks, showing healthy traffic momentum.":a.sessionsMomentum<-.05?"Sessions trended down in the past two weeks; review campaign and content cadence.":"Sessions are holding steady week over week.",impact:r(a.sessionsMomentum,"positive","negative","neutral")}),b.push({title:"Event demand",description:a.avgOccupancy>=.85?"Event attendance is exceeding 85% capacity—consider adding more sessions.":a.avgOccupancy<=.55?"Average attendance is below 55% of capacity—review pricing or promotion.":"Event attendance is healthy with mid-level capacity fill.",impact:a.avgOccupancy>=.85?"positive":a.avgOccupancy<=.55?"negative":"neutral"}),a.topDonor&&b.push({title:`${a.topDonor.name} leads giving`,description:`Top lifetime donor has contributed $${a.topDonor.totalGiven.toLocaleString()} — nurture this relationship for upcoming campaigns.`,impact:"positive"}),a.topEvent){let c=a.topEvent.ticketsTotal?Math.round(a.topEvent.ticketsSold/a.topEvent.ticketsTotal*100):null;b.push({title:`${a.topEvent.name} driving revenue`,description:`Highest-grossing event delivered $${a.topEvent.grossRevenue.toLocaleString()} in revenue${c?` at ${c}% capacity`:""}.`,impact:"positive"})}return a.topPage&&b.push({title:"Top content performer",description:`“${a.topPage.title}” led GA4 pageviews (${a.topPage.pageviews.toLocaleString()} views). Share this insight with marketing.`,impact:"neutral"}),b}({fundsMomentum:y,sessionsMomentum:z,avgOccupancy:A,topDonor:D?{name:D.name,totalGiven:D.totalGiven}:void 0,topEvent:B?{name:B.name,grossRevenue:B.grossRevenue,ticketsSold:B.ticketsSold,ticketsTotal:B.ticketsTotal}:void 0,topPage:C});return{generatedAt:b.toISOString(),range:c,dashboard:v,donors:w,events:{filters:d,data:x},analytics:{filters:e,data:i},metrics:{fundsMomentum:y,sessionsMomentum:z,avgOccupancy:A},highlights:E}}var t=a.i(31699);function u(a){return Number.isFinite(a)&&0!==a?`${a>0?"+":""}${(100*a).toFixed(1)} pts vs prior period`:"vs prior period"}let v={positive:"border-green-200 bg-green-50 text-green-900",negative:"border-red-200 bg-red-50 text-red-900",neutral:"border-slate-200 bg-white text-slate-700"};function w({value:a,color:c}){if(!Number.isFinite(a))return null;let d=Math.min(1,Math.max(.04,a));return(0,b.jsx)("div",{className:"mt-1 h-1.5 w-full overflow-hidden rounded-full bg-slate-100",children:(0,b.jsx)("div",{className:"h-full rounded-full",style:{width:`${100*d}%`,backgroundColor:c}})})}async function x(){var a,j;let k,l,m,n=await s(),o=n.events.data.charts.ticketsPerEvent.slice(0,8),p=n.events.data.charts.revenuePerEvent.slice(0,8),q=n.analytics.data.summary,r=n.donors.summary.totalDonors>0?n.donors.summary.activeDonors/n.donors.summary.totalDonors:0,x=n.events.data.summary.grossRevenue,y=n.events.data.summary.netRevenue,z=x>0?y/x:0,A=(k="string"==typeof(a=n.generatedAt)?new Date(a):a,new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"short"}).format(k)),B=n.events.filters.from??n.range.from,C=n.events.filters.to??n.range.to,D=n.analytics.filters.from??n.range.from,E=n.analytics.filters.to??n.range.to,F=[{label:"Funds raised (YTD)",value:(0,i.formatCurrency)(n.dashboard.kpis.fundsYtd),helper:u(n.metrics.fundsMomentum)},{label:"Active donors",value:(0,i.formatNumber)(n.dashboard.kpis.activeDonors),helper:`${(0,i.formatNumber)(n.donors.summary.totalDonors)} total`},{label:"Tickets sold",value:(0,i.formatNumber)(n.dashboard.kpis.ticketsSold),helper:`${(0,i.formatPercent)(n.metrics.avgOccupancy,0)} avg capacity`},{label:"Sessions (30d)",value:(0,i.formatNumber)(n.dashboard.kpis.sessionsLast30Days),helper:u(n.metrics.sessionsMomentum)}];return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsx)(e.PageHeader,{eyebrow:"Intelligence",title:"Integrated insights",description:"Unified dashboard for revenue, donor, event, and digital performance.",actions:(0,b.jsx)(t.InsightsReportButton,{}),children:(0,b.jsx)(e.PageHeaderMeta,{items:F,columns:4})}),(0,b.jsx)(c.Card,{title:"Insight highlights",description:"Auto-generated observations from merged datasets.",children:(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:n.highlights.map(a=>(0,b.jsxs)("div",{className:`rounded-2xl border p-4 shadow-sm transition ${v[a.impact]??v.neutral}`,children:[(0,b.jsx)("p",{className:"text-sm font-semibold",children:a.title}),(0,b.jsx)("p",{className:"mt-2 text-sm leading-6",children:a.description})]},a.title))})}),(0,b.jsxs)("section",{className:"grid gap-6 xl:grid-cols-3",children:[(0,b.jsx)(c.Card,{title:"Donor health",description:"Fundraising signals from the eTapestry sync.",children:(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Total donors"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatNumber)(n.donors.summary.totalDonors)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"All-time in CRM"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Active donors"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatNumber)(n.donors.summary.activeDonors)}),(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:["Gifted in last 12 months (",(0,i.formatPercent)(r),")"]}),(0,b.jsx)(w,{value:r,color:"#2563eb"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Avg lifetime value"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatCurrency)(n.donors.summary.averageLifetimeValue)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Mean revenue per donor"})]})]})}),(0,b.jsx)(c.Card,{title:"Revenue mix",description:"Eventbrite revenue + capacity snapshot.",children:(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Gross revenue"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatCurrency)(x)}),(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:[(0,i.formatNumber)(n.events.data.summary.ticketsSold)," tickets sold"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Net revenue"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatCurrency)(y)}),(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:[(0,i.formatPercent)(z)," of gross captured"]}),(0,b.jsx)(w,{value:z,color:"#059669"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Avg capacity fill"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatPercent)(n.metrics.avgOccupancy)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Across synced events"}),(0,b.jsx)(w,{value:n.metrics.avgOccupancy,color:"#f97316"})]})]})}),(0,b.jsx)(c.Card,{title:"Data freshness",description:"Windows synced into this briefing.",children:(0,b.jsxs)("dl",{className:"space-y-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"font-semibold text-slate-600",children:"Insights generated"}),(0,b.jsx)("dd",{className:"text-slate-900",children:A})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"font-semibold text-slate-600",children:"Financial window"}),(0,b.jsxs)("dd",{className:"text-slate-900",children:[(0,i.formatDate)(n.range.from)," – ",(0,i.formatDate)(n.range.to)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"font-semibold text-slate-600",children:"Events window"}),(0,b.jsxs)("dd",{className:"text-slate-900",children:[(0,i.formatDate)(B)," – ",(0,i.formatDate)(C)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"font-semibold text-slate-600",children:"Web analytics window"}),(0,b.jsxs)("dd",{className:"text-slate-900",children:[(0,i.formatDate)(D)," – ",(0,i.formatDate)(E)]})]})]})})]}),(0,b.jsx)(c.Card,{title:"Monthly performance",description:"Funds raised, tickets sold, and website sessions across the last 12 months.",children:(0,b.jsx)(f.TimeSeriesChart,{data:n.dashboard.charts.monthly,lines:[{dataKey:"funds",color:"#0f172a",name:"Funds raised ($)"},{dataKey:"tickets",color:"#2563eb",name:"Tickets sold"},{dataKey:"sessions",color:"#059669",name:"Sessions"}]})}),(0,b.jsxs)("section",{className:"grid gap-6 lg:grid-cols-2",children:[(0,b.jsx)(c.Card,{title:"Top donors",description:"Highest lifetime value donors with most recent gift date.",actions:(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:["Avg lifetime value ",(0,i.formatCurrency)(n.donors.summary.averageLifetimeValue)]}),children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(d.Table,{children:[(0,b.jsxs)(d.THead,{children:[(0,b.jsx)(d.TH,{children:"Name"}),(0,b.jsx)(d.TH,{children:"Email"}),(0,b.jsx)(d.TH,{children:"Lifetime given"}),(0,b.jsx)(d.TH,{children:"Last gift"})]}),(0,b.jsx)(d.TBody,{children:n.donors.donors.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)(d.TD,{className:"font-semibold text-slate-900",children:a.name}),(0,b.jsx)(d.TD,{children:a.email??"—"}),(0,b.jsx)(d.TD,{children:(0,i.formatCurrency)(a.totalGiven)}),(0,b.jsx)(d.TD,{children:a.lastGiftDate?(0,i.formatDate)(a.lastGiftDate):"No gifts"})]},a.id))})]})})}),(0,b.jsx)(c.Card,{title:"Event performance snapshot",description:"Most recent Eventbrite programs with revenue and capacity details.",actions:(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:[(0,i.formatNumber)(n.events.data.summary.upcomingEvents)," upcoming ·"," ",(0,i.formatNumber)(n.events.data.summary.pastEvents)," past"]}),children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(d.Table,{children:[(0,b.jsxs)(d.THead,{children:[(0,b.jsx)(d.TH,{children:"Name"}),(0,b.jsx)(d.TH,{children:"Dates"}),(0,b.jsx)(d.TH,{children:"Tickets"}),(0,b.jsx)(d.TH,{children:"Capacity"}),(0,b.jsx)(d.TH,{children:"Gross revenue"})]}),(0,b.jsx)(d.TBody,{children:n.events.data.events.slice(0,5).map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)(d.TD,{className:"font-semibold text-slate-900",children:a.name}),(0,b.jsxs)(d.TD,{className:"text-sm text-slate-600",children:[(0,i.formatDate)(a.startDate)," – ",(0,i.formatDate)(a.endDate)]}),(0,b.jsx)(d.TD,{children:(0,i.formatNumber)(a.ticketsSold)}),(0,b.jsxs)(d.TD,{children:[(0,i.formatNumber)(a.ticketsTotal)," (",(0,i.formatPercent)(a.ticketsTotal?a.ticketsSold/a.ticketsTotal:0),")"]}),(0,b.jsx)(d.TD,{children:(0,i.formatCurrency)(a.grossRevenue)})]},a.id))})]})})})]}),(0,b.jsxs)("section",{className:"grid gap-6 lg:grid-cols-2",children:[(0,b.jsx)(c.Card,{title:"Tickets per event",description:"Top recent programs ranked by attendance.",children:(0,b.jsx)(g.BarChartComponent,{data:o,bars:[{dataKey:"tickets",color:"#2563eb",name:"Tickets sold"}],footer:(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Data source: Eventbrite"})})}),(0,b.jsx)(c.Card,{title:"Revenue per event",description:"Gross vs. net performance for recent programs.",children:(0,b.jsx)(g.BarChartComponent,{data:p,bars:[{dataKey:"gross",color:"#0f172a",name:"Gross"},{dataKey:"net",color:"#059669",name:"Net"}],stacked:!1,footer:(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Bars highlight net capture per program."})})})]}),(0,b.jsxs)("section",{className:"grid gap-6 lg:grid-cols-2",children:[(0,b.jsx)(c.Card,{title:"Donor acquisition (last 12 months)",children:(0,b.jsx)(g.BarChartComponent,{data:n.donors.charts.acquisitions,bars:[{dataKey:"value",color:"#2563eb",name:"New donors"}],footer:(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Source: eTapestry synced donors"})})}),(0,b.jsx)(c.Card,{title:"Gift distribution",children:(0,b.jsx)(h.PieChartComponent,{data:n.donors.charts.giftDistribution,footer:(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Segments by donor lifetime value"})})})]}),(0,b.jsxs)("section",{className:"grid gap-6 xl:grid-cols-3",children:[(0,b.jsx)(c.Card,{className:"xl:col-span-2",title:"Sessions (last 30 days)",description:"Google Analytics 4 daily sessions trend.",children:(0,b.jsx)(f.TimeSeriesChart,{data:n.analytics.data.sessionsSeries.points,lines:[{dataKey:"value",color:"#0f172a",name:"Sessions"}],footer:n.analytics.data.sessionsSeries.error?(0,b.jsx)("p",{className:"text-sm text-red-500",children:n.analytics.data.sessionsSeries.error}):(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Source: Google Analytics Data API"})})}),(0,b.jsx)(c.Card,{title:"Engagement breakdown",description:"Key GA4 metrics for the selected window.",children:(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Users"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatNumber)(q.users)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Unique visitors in window"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Sessions"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatNumber)(q.sessions)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:u(n.metrics.sessionsMomentum)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Pageviews"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(0,i.formatNumber)(q.pageviews)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Total content views"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-600",children:"Avg engagement"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:(l=Math.floor((j=q.averageEngagementTime)/60),m=Math.round(j%60),`${l}m ${m.toString().padStart(2,"0")}s`)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Per engaged session"})]})]})})]}),(0,b.jsxs)(c.Card,{title:"Top pages",description:"Highest pageviews by title.",children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(d.Table,{children:[(0,b.jsxs)(d.THead,{children:[(0,b.jsx)(d.TH,{children:"Path"}),(0,b.jsx)(d.TH,{children:"Title"}),(0,b.jsx)(d.TH,{children:"Pageviews"})]}),(0,b.jsx)(d.TBody,{children:n.analytics.data.topPages.rows.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)(d.TD,{className:"font-medium",children:a.path}),(0,b.jsx)(d.TD,{children:a.title}),(0,b.jsx)(d.TD,{children:(0,i.formatNumber)(a.pageviews)})]},`${a.path}-${a.title}`))})]})}),n.analytics.data.topPages.error?(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:n.analytics.data.topPages.error}):null]})]})}a.s(["default",()=>x,"dynamic",0,"force-dynamic"],98696)}];

//# sourceMappingURL=src_app_%28dashboard%29_insights_8aa897bc._.js.map