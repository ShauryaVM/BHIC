module.exports=[71148,14355,40826,a=>{"use strict";let b;var c=a.i(29173),d=a.i(31290);let e={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(a,b){return b},attributeValueProcessor:function(a,b){return b},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(a,b,c){return a},captureMetaData:!1},f=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",g=RegExp("^"+("["+f+"]["+f)+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$");function h(a,b){let c=[],d=b.exec(a);for(;d;){let e=[];e.startIndex=b.lastIndex-d[0].length;let f=d.length;for(let a=0;a<f;a++)e.push(d[a]);c.push(e),d=b.exec(a)}return c}let i=function(a){return null!=g.exec(a)};b="function"!=typeof Symbol?"@@xmlMetadata":Symbol("XML Node Metadata");class j{constructor(a){this.tagname=a,this.child=[],this[":@"]={}}add(a,b){"__proto__"===a&&(a="#__proto__"),this.child.push({[a]:b})}addChild(a,c){"__proto__"===a.tagname&&(a.tagname="#__proto__"),a[":@"]&&Object.keys(a[":@"]).length>0?this.child.push({[a.tagname]:a.child,":@":a[":@"]}):this.child.push({[a.tagname]:a.child}),void 0!==c&&(this.child[this.child.length-1][b]={startIndex:c})}static getMetaDataSymbol(){return b}}class k{constructor(a){this.suppressValidationErr=!a}readDocType(a,b){let c={};if("O"===a[b+3]&&"C"===a[b+4]&&"T"===a[b+5]&&"Y"===a[b+6]&&"P"===a[b+7]&&"E"===a[b+8]){b+=9;let d=1,e=!1,f=!1;for(;b<a.length;b++)if("<"!==a[b]||f)if(">"===a[b]){if(f?"-"===a[b-1]&&"-"===a[b-2]&&(f=!1,d--):d--,0===d)break}else"["===a[b]?e=!0:a[b];else{if(e&&m(a,"!ENTITY",b)){let d,e;b+=7,[d,e,b]=this.readEntityExp(a,b+1,this.suppressValidationErr),-1===e.indexOf("&")&&(c[d]={regx:RegExp(`&${d};`,"g"),val:e})}else if(e&&m(a,"!ELEMENT",b)){b+=8;let{index:c}=this.readElementExp(a,b+1);b=c}else if(e&&m(a,"!ATTLIST",b))b+=8;else if(e&&m(a,"!NOTATION",b)){b+=9;let{index:c}=this.readNotationExp(a,b+1,this.suppressValidationErr);b=c}else if(m(a,"!--",b))f=!0;else throw Error("Invalid DOCTYPE");d++}if(0!==d)throw Error("Unclosed DOCTYPE")}else throw Error("Invalid Tag instead of DOCTYPE");return{entities:c,i:b}}readEntityExp(a,b){b=l(a,b);let c="";for(;b<a.length&&!/\s/.test(a[b])&&'"'!==a[b]&&"'"!==a[b];)c+=a[b],b++;if(n(c),b=l(a,b),!this.suppressValidationErr){if("SYSTEM"===a.substring(b,b+6).toUpperCase())throw Error("External entities are not supported");else if("%"===a[b])throw Error("Parameter entities are not supported")}let d="";return[b,d]=this.readIdentifierVal(a,b,"entity"),[c,d,--b]}readNotationExp(a,b){b=l(a,b);let c="";for(;b<a.length&&!/\s/.test(a[b]);)c+=a[b],b++;this.suppressValidationErr||n(c),b=l(a,b);let d=a.substring(b,b+6).toUpperCase();if(!this.suppressValidationErr&&"SYSTEM"!==d&&"PUBLIC"!==d)throw Error(`Expected SYSTEM or PUBLIC, found "${d}"`);b+=d.length,b=l(a,b);let e=null,f=null;if("PUBLIC"===d)[b,e]=this.readIdentifierVal(a,b,"publicIdentifier"),b=l(a,b),('"'===a[b]||"'"===a[b])&&([b,f]=this.readIdentifierVal(a,b,"systemIdentifier"));else if("SYSTEM"===d&&([b,f]=this.readIdentifierVal(a,b,"systemIdentifier"),!this.suppressValidationErr&&!f))throw Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:c,publicIdentifier:e,systemIdentifier:f,index:--b}}readIdentifierVal(a,b,c){let d="",e=a[b];if('"'!==e&&"'"!==e)throw Error(`Expected quoted string, found "${e}"`);for(b++;b<a.length&&a[b]!==e;)d+=a[b],b++;if(a[b]!==e)throw Error(`Unterminated ${c} value`);return[++b,d]}readElementExp(a,b){b=l(a,b);let c="";for(;b<a.length&&!/\s/.test(a[b]);)c+=a[b],b++;if(!this.suppressValidationErr&&!i(c))throw Error(`Invalid element name: "${c}"`);b=l(a,b);let d="";if("E"===a[b]&&m(a,"MPTY",b))b+=4;else if("A"===a[b]&&m(a,"NY",b))b+=2;else if("("===a[b]){for(b++;b<a.length&&")"!==a[b];)d+=a[b],b++;if(")"!==a[b])throw Error("Unterminated content model")}else if(!this.suppressValidationErr)throw Error(`Invalid Element Expression, found "${a[b]}"`);return{elementName:c,contentModel:d.trim(),index:b}}readAttlistExp(a,b){b=l(a,b);let c="";for(;b<a.length&&!/\s/.test(a[b]);)c+=a[b],b++;n(c),b=l(a,b);let d="";for(;b<a.length&&!/\s/.test(a[b]);)d+=a[b],b++;if(!n(d))throw Error(`Invalid attribute name: "${d}"`);b=l(a,b);let e="";if("NOTATION"===a.substring(b,b+8).toUpperCase()){if(e="NOTATION",b+=8,b=l(a,b),"("!==a[b])throw Error(`Expected '(', found "${a[b]}"`);b++;let c=[];for(;b<a.length&&")"!==a[b];){let d="";for(;b<a.length&&"|"!==a[b]&&")"!==a[b];)d+=a[b],b++;if(!n(d=d.trim()))throw Error(`Invalid notation name: "${d}"`);c.push(d),"|"===a[b]&&(b=l(a,++b))}if(")"!==a[b])throw Error("Unterminated list of notations");b++,e+=" ("+c.join("|")+")"}else{for(;b<a.length&&!/\s/.test(a[b]);)e+=a[b],b++;if(!this.suppressValidationErr&&!["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"].includes(e.toUpperCase()))throw Error(`Invalid attribute type: "${e}"`)}b=l(a,b);let f="";return"#REQUIRED"===a.substring(b,b+8).toUpperCase()?(f="#REQUIRED",b+=8):"#IMPLIED"===a.substring(b,b+7).toUpperCase()?(f="#IMPLIED",b+=7):[b,f]=this.readIdentifierVal(a,b,"ATTLIST"),{elementName:c,attributeName:d,attributeType:e,defaultValue:f,index:b}}}let l=(a,b)=>{for(;b<a.length&&/\s/.test(a[b]);)b++;return b};function m(a,b,c){for(let d=0;d<b.length;d++)if(b[d]!==a[c+d+1])return!1;return!0}function n(a){if(i(a))return a;throw Error(`Invalid entity name ${a}`)}let o=/^[-+]?0x[a-fA-F0-9]+$/,p=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,q={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0},r=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;class s{constructor(a){if(this.options=a,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(a,b)=>String.fromCodePoint(Number.parseInt(b,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(a,b)=>String.fromCodePoint(Number.parseInt(b,16))}},this.addExternalEntities=t,this.parseXml=y,this.parseTextData=u,this.resolveNameSpace=v,this.buildAttributesMap=x,this.isItStopNode=C,this.replaceEntitiesValue=A,this.readStopNodeData=F,this.saveTextToParentTag=B,this.addChild=z,this.ignoreAttributesFn=function(a){return"function"==typeof a?a:Array.isArray(a)?b=>{for(let c of a)if("string"==typeof c&&b===c||c instanceof RegExp&&c.test(b))return!0}:()=>!1}(this.options.ignoreAttributes),this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let a=0;a<this.options.stopNodes.length;a++){const b=this.options.stopNodes[a];"string"==typeof b&&(b.startsWith("*.")?this.stopNodesWildcard.add(b.substring(2)):this.stopNodesExact.add(b))}}}}function t(a){let b=Object.keys(a);for(let c=0;c<b.length;c++){let d=b[c];this.lastEntities[d]={regex:RegExp("&"+d+";","g"),val:a[d]}}}function u(a,b,c,d,e,f,g){if(void 0!==a&&(this.options.trimValues&&!d&&(a=a.trim()),a.length>0)){g||(a=this.replaceEntitiesValue(a));let d=this.options.tagValueProcessor(b,a,c,e,f);return null==d?a:typeof d!=typeof a||d!==a?d:this.options.trimValues||a.trim()===a?G(a,this.options.parseTagValue,this.options.numberParseOptions):a}}function v(a){if(this.options.removeNSPrefix){let b=a.split(":"),c="/"===a.charAt(0)?"/":"";if("xmlns"===b[0])return"";2===b.length&&(a=c+b[1])}return a}let w=RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function x(a,b,c){if(!0!==this.options.ignoreAttributes&&"string"==typeof a){let c=h(a,w),d=c.length,e={};for(let a=0;a<d;a++){let d=this.resolveNameSpace(c[a][1]);if(this.ignoreAttributesFn(d,b))continue;let f=c[a][4],g=this.options.attributeNamePrefix+d;if(d.length)if(this.options.transformAttributeName&&(g=this.options.transformAttributeName(g)),"__proto__"===g&&(g="#__proto__"),void 0!==f){this.options.trimValues&&(f=f.trim()),f=this.replaceEntitiesValue(f);let a=this.options.attributeValueProcessor(d,f,b);null==a?e[g]=f:typeof a!=typeof f||a!==f?e[g]=a:e[g]=G(f,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(e[g]=!0)}if(Object.keys(e).length){if(this.options.attributesGroupName){let a={};return a[this.options.attributesGroupName]=e,a}return e}}}let y=function(a){a=a.replace(/\r\n?/g,"\n");let b=new j("!xml"),c=b,d="",e="",f=new k(this.options.processEntities);for(let g=0;g<a.length;g++)if("<"===a[g])if("/"===a[g+1]){let b=D(a,">",g,"Closing Tag is not closed."),f=a.substring(g+2,b).trim();if(this.options.removeNSPrefix){let a=f.indexOf(":");-1!==a&&(f=f.substr(a+1))}this.options.transformTagName&&(f=this.options.transformTagName(f)),c&&(d=this.saveTextToParentTag(d,c,e));let h=e.substring(e.lastIndexOf(".")+1);if(f&&-1!==this.options.unpairedTags.indexOf(f))throw Error(`Unpaired tag can not be used as closing tag: </${f}>`);let i=0;h&&-1!==this.options.unpairedTags.indexOf(h)?(i=e.lastIndexOf(".",e.lastIndexOf(".")-1),this.tagsNodeStack.pop()):i=e.lastIndexOf("."),e=e.substring(0,i),c=this.tagsNodeStack.pop(),d="",g=b}else if("?"===a[g+1]){let b=E(a,g,!1,"?>");if(!b)throw Error("Pi Tag is not closed.");if(d=this.saveTextToParentTag(d,c,e),this.options.ignoreDeclaration&&"?xml"===b.tagName||this.options.ignorePiTags);else{let a=new j(b.tagName);a.add(this.options.textNodeName,""),b.tagName!==b.tagExp&&b.attrExpPresent&&(a[":@"]=this.buildAttributesMap(b.tagExp,e,b.tagName)),this.addChild(c,a,e,g)}g=b.closeIndex+1}else if("!--"===a.substr(g+1,3)){let b=D(a,"-->",g+4,"Comment is not closed.");if(this.options.commentPropName){let f=a.substring(g+4,b-2);d=this.saveTextToParentTag(d,c,e),c.add(this.options.commentPropName,[{[this.options.textNodeName]:f}])}g=b}else if("!D"===a.substr(g+1,2)){let b=f.readDocType(a,g);this.docTypeEntities=b.entities,g=b.i}else if("!["===a.substr(g+1,2)){let b=D(a,"]]>",g,"CDATA is not closed.")-2,f=a.substring(g+9,b);d=this.saveTextToParentTag(d,c,e);let h=this.parseTextData(f,c.tagname,e,!0,!1,!0,!0);void 0==h&&(h=""),this.options.cdataPropName?c.add(this.options.cdataPropName,[{[this.options.textNodeName]:f}]):c.add(this.options.textNodeName,h),g=b+2}else{let f=E(a,g,this.options.removeNSPrefix),h=f.tagName,i=f.rawTagName,k=f.tagExp,l=f.attrExpPresent,m=f.closeIndex;this.options.transformTagName&&(h=this.options.transformTagName(h)),c&&d&&"!xml"!==c.tagname&&(d=this.saveTextToParentTag(d,c,e,!1));let n=c;n&&-1!==this.options.unpairedTags.indexOf(n.tagname)&&(c=this.tagsNodeStack.pop(),e=e.substring(0,e.lastIndexOf("."))),h!==b.tagname&&(e+=e?"."+h:h);let o=g;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,e,h)){let b="";if(k.length>0&&k.lastIndexOf("/")===k.length-1)"/"===h[h.length-1]?(h=h.substr(0,h.length-1),e=e.substr(0,e.length-1),k=h):k=k.substr(0,k.length-1),g=f.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(h))g=f.closeIndex;else{let c=this.readStopNodeData(a,i,m+1);if(!c)throw Error(`Unexpected end of ${i}`);g=c.i,b=c.tagContent}let d=new j(h);h!==k&&l&&(d[":@"]=this.buildAttributesMap(k,e,h)),b&&(b=this.parseTextData(b,h,e,!0,l,!0,!0)),e=e.substr(0,e.lastIndexOf(".")),d.add(this.options.textNodeName,b),this.addChild(c,d,e,o)}else{if(k.length>0&&k.lastIndexOf("/")===k.length-1){"/"===h[h.length-1]?(h=h.substr(0,h.length-1),e=e.substr(0,e.length-1),k=h):k=k.substr(0,k.length-1),this.options.transformTagName&&(h=this.options.transformTagName(h));let a=new j(h);h!==k&&l&&(a[":@"]=this.buildAttributesMap(k,e,h)),this.addChild(c,a,e,o),e=e.substr(0,e.lastIndexOf("."))}else{let a=new j(h);this.tagsNodeStack.push(c),h!==k&&l&&(a[":@"]=this.buildAttributesMap(k,e,h)),this.addChild(c,a,e,o),c=a}d="",g=m}}else d+=a[g];return b.child};function z(a,b,c,d){this.options.captureMetaData||(d=void 0);let e=this.options.updateTag(b.tagname,c,b[":@"]);!1===e||("string"==typeof e&&(b.tagname=e),a.addChild(b,d))}let A=function(a){if(this.options.processEntities){for(let b in this.docTypeEntities){let c=this.docTypeEntities[b];a=a.replace(c.regx,c.val)}for(let b in this.lastEntities){let c=this.lastEntities[b];a=a.replace(c.regex,c.val)}if(this.options.htmlEntities)for(let b in this.htmlEntities){let c=this.htmlEntities[b];a=a.replace(c.regex,c.val)}a=a.replace(this.ampEntity.regex,this.ampEntity.val)}return a};function B(a,b,c,d){return a&&(void 0===d&&(d=0===b.child.length),void 0!==(a=this.parseTextData(a,b.tagname,c,!1,!!b[":@"]&&0!==Object.keys(b[":@"]).length,d))&&""!==a&&b.add(this.options.textNodeName,a),a=""),a}function C(a,b,c,d){return!!(b&&b.has(d)||a&&a.has(c))}function D(a,b,c,d){let e=a.indexOf(b,c);if(-1!==e)return e+b.length-1;throw Error(d)}function E(a,b,c,d=">"){let e=function(a,b,c=">"){let d,e="";for(let f=b;f<a.length;f++){let b=a[f];if(d)b===d&&(d="");else if('"'===b||"'"===b)d=b;else if(b===c[0]){if(!c[1])return{data:e,index:f};else if(a[f+1]===c[1])return{data:e,index:f}}else"	"===b&&(b=" ");e+=b}}(a,b+1,d);if(!e)return;let f=e.data,g=e.index,h=f.search(/\s/),i=f,j=!0;-1!==h&&(i=f.substring(0,h),f=f.substring(h+1).trimStart());let k=i;if(c){let a=i.indexOf(":");-1!==a&&(j=(i=i.substr(a+1))!==e.data.substr(a+1))}return{tagName:i,tagExp:f,closeIndex:g,attrExpPresent:j,rawTagName:k}}function F(a,b,c){let d=c,e=1;for(;c<a.length;c++)if("<"===a[c])if("/"===a[c+1]){let f=D(a,">",c,`${b} is not closed`);if(a.substring(c+2,f).trim()===b&&0==--e)return{tagContent:a.substring(d,c),i:f};c=f}else if("?"===a[c+1])c=D(a,"?>",c+1,"StopNode is not closed.");else if("!--"===a.substr(c+1,3))c=D(a,"-->",c+3,"StopNode is not closed.");else if("!["===a.substr(c+1,2))c=D(a,"]]>",c,"StopNode is not closed.")-2;else{let d=E(a,c,">");d&&((d&&d.tagName)===b&&"/"!==d.tagExp[d.tagExp.length-1]&&e++,c=d.closeIndex)}}function G(a,b,c){if(b&&"string"==typeof a){let b=a.trim();return"true"===b||"false"!==b&&function(a,b={}){if(b=Object.assign({},q,b),!a||"string"!=typeof a)return a;let c=a.trim();if(void 0!==b.skipLike&&b.skipLike.test(c))return a;{if("0"===a)return 0;if(b.hex&&o.test(c)){var d,e=c;if(parseInt)return parseInt(e,16);if(Number.parseInt)return Number.parseInt(e,16);if(window&&window.parseInt)return window.parseInt(e,16);throw Error("parseInt, Number.parseInt, window.parseInt are not supported")}if(-1!==c.search(/.+[eE].+/))return function(a,b,c){if(!c.eNotation)return a;let d=b.match(r);if(!d)return a;{let e=d[1]||"",f=-1===d[3].indexOf("e")?"E":"e",g=d[2],h=e?a[g.length+1]===f:a[g.length]===f;return g.length>1&&h?a:1===g.length&&(d[3].startsWith(`.${f}`)||d[3][0]===f)?Number(b):c.leadingZeros&&!h?Number(b=(d[1]||"")+d[3]):a}}(a,c,b);let f=p.exec(c);if(!f)return a;{let e=f[1]||"",g=f[2],h=((d=f[3])&&-1!==d.indexOf(".")&&("."===(d=d.replace(/0+$/,""))?d="0":"."===d[0]?d="0"+d:"."===d[d.length-1]&&(d=d.substring(0,d.length-1))),d),i=e?"."===a[g.length+1]:"."===a[g.length];if(!b.leadingZeros&&(g.length>1||1===g.length&&!i))return a;{let d=Number(c),f=String(d);if(0===d)return d;if(-1!==f.search(/[eE]/))if(b.eNotation)return d;else return a;if(-1!==c.indexOf("."))if("0"===f)return d;else if(f===h)return d;else if(f===`${e}${h}`)return d;else return a;let i=g?h:c;return g?i===f||e+i===f?d:a:i===f||i===e+f?d:a}}}}(a,c)}return void 0!==a?a:""}let H=j.getMetaDataSymbol(),I={allowBooleanAttributes:!1,unpairedTags:[]};function J(a){return" "===a||"	"===a||"\n"===a||"\r"===a}function K(a,b){let c=b;for(;b<a.length;b++)if("?"==a[b]||" "==a[b]){let d=a.substr(c,b-c);if(b>5&&"xml"===d)return O("InvalidXml","XML declaration allowed only at the start of the document.",P(a,b));if("?"!=a[b]||">"!=a[b+1])continue;b++;break}return b}function L(a,b){if(a.length>b+5&&"-"===a[b+1]&&"-"===a[b+2]){for(b+=3;b<a.length;b++)if("-"===a[b]&&"-"===a[b+1]&&">"===a[b+2]){b+=2;break}}else if(a.length>b+8&&"D"===a[b+1]&&"O"===a[b+2]&&"C"===a[b+3]&&"T"===a[b+4]&&"Y"===a[b+5]&&"P"===a[b+6]&&"E"===a[b+7]){let c=1;for(b+=8;b<a.length;b++)if("<"===a[b])c++;else if(">"===a[b]&&0==--c)break}else if(a.length>b+9&&"["===a[b+1]&&"C"===a[b+2]&&"D"===a[b+3]&&"A"===a[b+4]&&"T"===a[b+5]&&"A"===a[b+6]&&"["===a[b+7]){for(b+=8;b<a.length;b++)if("]"===a[b]&&"]"===a[b+1]&&">"===a[b+2]){b+=2;break}}return b}let M=RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function N(a,b){let c=h(a,M),d={};for(let a=0;a<c.length;a++){if(0===c[a][1].length)return O("InvalidAttr","Attribute '"+c[a][2]+"' has no space in starting.",Q(c[a]));if(void 0!==c[a][3]&&void 0===c[a][4])return O("InvalidAttr","Attribute '"+c[a][2]+"' is without value.",Q(c[a]));if(void 0===c[a][3]&&!b.allowBooleanAttributes)return O("InvalidAttr","boolean attribute '"+c[a][2]+"' is not allowed.",Q(c[a]));let e=c[a][2];if(!i(e))return O("InvalidAttr","Attribute '"+e+"' is an invalid name.",Q(c[a]));if(d.hasOwnProperty(e))return O("InvalidAttr","Attribute '"+e+"' is repeated.",Q(c[a]));d[e]=1}return!0}function O(a,b,c){return{err:{code:a,msg:b,line:c.line||c,col:c.col}}}function P(a,b){let c=a.substring(0,b).split(/\r?\n/);return{line:c.length,col:c[c.length-1].length+1}}function Q(a){return a.startIndex+a[1].length}var R=a.i(28954),S=a.i(92665),T=a.i(66518);let U={[c.MetricSource.ETAPESTRY]:"integration:etapestry",[c.MetricSource.EVENTBRITE]:"integration:eventbrite",[c.MetricSource.GA4]:null,[c.MetricSource.INTERNAL]:null};async function V(a,b){if(!U[a])return;let d=new Date;await T.prisma.cachedMetric.create({data:{key:(a=>{let b=U[a];if(!b)throw Error(`Unsupported integration source ${a}`);return b})(a),value:{...b,timestamp:d.toISOString(),source:a},fromDate:d,toDate:d,source:c.MetricSource.INTERNAL}})}async function W(){let a=await T.prisma.cachedMetric.findMany({where:{key:{in:["integration:etapestry","integration:eventbrite"]}},orderBy:{createdAt:"desc"}}),b=new Map;for(let c of a)b.has(c.key)||b.set(c.key,c);let c=a=>{let c=b.get(a);if(!c)return null;let d=c.value,e=d?.timestamp&&"string"==typeof d.timestamp?d.timestamp:c.createdAt.toISOString();return{synced:"number"==typeof d?.synced?d.synced:void 0,error:"string"==typeof d?.error?d.error:void 0,timestamp:e}};return{etapestry:c("integration:etapestry"),eventbrite:c("integration:eventbrite")}}async function X(a){a.length&&await T.prisma.cachedMetric.deleteMany({where:{source:{in:a}}})}a.s(["getIntegrationStatuses",()=>W,"invalidateMetricsForSources",()=>X,"recordIntegrationSync",()=>V],14355);var Y=a.i(65314);let Z=new Set(Object.values(c.PledgeStatus)),$=new class{constructor(a){this.externalEntities={},this.options=Object.assign({},e,a)}parse(a,b){if("string"!=typeof a&&a.toString)a=a.toString();else if("string"!=typeof a)throw Error("XML data is accepted in String or Bytes[] form.");if(b){!0===b&&(b={});let c=function(a,b){b=Object.assign({},I,b);let c=[],d=!1,e=!1;"\uFEFF"===a[0]&&(a=a.substr(1));for(let f=0;f<a.length;f++)if("<"===a[f]&&"?"===a[f+1]){if(f+=2,(f=K(a,f)).err)return f}else if("<"===a[f]){let g=f;if("!"===a[++f]){f=L(a,f);continue}{let h=!1;"/"===a[f]&&(h=!0,f++);let j="";for(;f<a.length&&">"!==a[f]&&" "!==a[f]&&"	"!==a[f]&&"\n"!==a[f]&&"\r"!==a[f];f++)j+=a[f];if("/"===(j=j.trim())[j.length-1]&&(j=j.substring(0,j.length-1),f--),!i(j))return O("InvalidTag",0===j.trim().length?"Invalid space after '<'.":"Tag '"+j+"' is an invalid name.",P(a,f));let k=function(a,b){let c="",d="",e=!1;for(;b<a.length;b++){if('"'===a[b]||"'"===a[b])""===d?d=a[b]:d!==a[b]||(d="");else if(">"===a[b]&&""===d){e=!0;break}c+=a[b]}return""===d&&{value:c,index:b,tagClosed:e}}(a,f);if(!1===k)return O("InvalidAttr","Attributes for '"+j+"' have open quote.",P(a,f));let l=k.value;if(f=k.index,"/"===l[l.length-1]){let c=f-l.length,e=N(l=l.substring(0,l.length-1),b);if(!0!==e)return O(e.err.code,e.err.msg,P(a,c+e.err.line));d=!0}else if(h)if(!k.tagClosed)return O("InvalidTag","Closing tag '"+j+"' doesn't have proper closing.",P(a,f));else{if(l.trim().length>0)return O("InvalidTag","Closing tag '"+j+"' can't have attributes or invalid starting.",P(a,g));if(0===c.length)return O("InvalidTag","Closing tag '"+j+"' has not been opened.",P(a,g));let b=c.pop();if(j!==b.tagName){let c=P(a,b.tagStartPos);return O("InvalidTag","Expected closing tag '"+b.tagName+"' (opened in line "+c.line+", col "+c.col+") instead of closing tag '"+j+"'.",P(a,g))}0==c.length&&(e=!0)}else{let h=N(l,b);if(!0!==h)return O(h.err.code,h.err.msg,P(a,f-l.length+h.err.line));if(!0===e)return O("InvalidXml","Multiple possible root nodes found.",P(a,f));-1!==b.unpairedTags.indexOf(j)||c.push({tagName:j,tagStartPos:g}),d=!0}for(f++;f<a.length;f++)if("<"===a[f])if("!"===a[f+1]){f=L(a,++f);continue}else if("?"===a[f+1]){if((f=K(a,++f)).err)return f}else break;else if("&"===a[f]){let b=function(a,b){if(";"===a[++b])return -1;if("#"===a[b]){var c=++b;let d=/\d/;for("x"===a[c]&&(c++,d=/[\da-fA-F]/);c<a.length;c++){if(";"===a[c])return c;if(!a[c].match(d))break}return -1}let d=0;for(;b<a.length;b++,d++)if(!a[b].match(/\w/)||!(d<20)){if(";"===a[b])break;return -1}return b}(a,f);if(-1==b)return O("InvalidChar","char '&' is not expected.",P(a,f));f=b}else if(!0===e&&!J(a[f]))return O("InvalidXml","Extra text at the end",P(a,f));"<"===a[f]&&f--}}else{if(J(a[f]))continue;return O("InvalidChar","char '"+a[f]+"' is not expected.",P(a,f))}return d?1==c.length?O("InvalidTag","Unclosed tag '"+c[0].tagName+"'.",P(a,c[0].tagStartPos)):!(c.length>0)||O("InvalidXml","Invalid '"+JSON.stringify(c.map(a=>a.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):O("InvalidXml","Start tag expected.",1)}(a,b);if(!0!==c)throw Error(`${c.err.msg}:${c.err.line}:${c.err.col}`)}let c=new s(this.options);c.addExternalEntities(this.externalEntities);let d=c.parseXml(a);return this.options.preserveOrder||void 0===d?d:function a(b,c,d){let e,f={};for(let g=0;g<b.length;g++){let h=b[g],i=function(a){let b=Object.keys(a);for(let a=0;a<b.length;a++){let c=b[a];if(":@"!==c)return c}}(h),j="";if(j=void 0===d?i:d+"."+i,i===c.textNodeName)void 0===e?e=h[i]:e+=""+h[i];else if(void 0===i)continue;else if(h[i]){let b=a(h[i],c,j),d=function(a,b){let{textNodeName:c}=b,d=Object.keys(a).length;return 0===d||1===d&&(!!a[c]||"boolean"==typeof a[c]||0===a[c])}(b,c);void 0!==h[H]&&(b[H]=h[H]),h[":@"]?function(a,b,c,d){if(b){let e=Object.keys(b),f=e.length;for(let g=0;g<f;g++){let f=e[g];d.isArray(f,c+"."+f,!0,!0)?a[f]=[b[f]]:a[f]=b[f]}}}(b,h[":@"],j,c):1!==Object.keys(b).length||void 0===b[c.textNodeName]||c.alwaysCreateTextNode?0===Object.keys(b).length&&(c.alwaysCreateTextNode?b[c.textNodeName]="":b=""):b=b[c.textNodeName],void 0!==f[i]&&f.hasOwnProperty(i)?(Array.isArray(f[i])||(f[i]=[f[i]]),f[i].push(b)):c.isArray(i,j,d)?f[i]=[b]:f[i]=b}}return"string"==typeof e?e.length>0&&(f[c.textNodeName]=e):void 0!==e&&(f[c.textNodeName]=e),f}(d,this.options)}addEntity(a,b){if(-1!==b.indexOf("&"))throw Error("Entity value can't have '&'");if(-1!==a.indexOf("&")||-1!==a.indexOf(";"))throw Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===b)throw Error("An entity with value '&' is not permitted");this.externalEntities[a]=b}static getMetaDataSymbol(){return j.getMetaDataSymbol()}}({ignoreAttributes:!1,attributeNamePrefix:"",textNodeName:"text",removeNSPrefix:!1}),_=(()=>{try{let a=new URL(S.env.ETAPESTRY_WSDL_URL);return a.search="",a.toString()}catch{return S.env.ETAPESTRY_WSDL_URL.replace(/\?wsdl$/i,"").replace(/\?WSDL$/i,"")}})(),aa=null;class ab extends Error{faultCode;detail;raw}class ac extends Error{status;body;constructor(a,b,c){super(a),this.status=b,this.body=c}}function ad(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ae(a){if(!a)return c.PledgeStatus.PLEDGED;let b=a.toUpperCase();return Z.has(b)?b:c.PledgeStatus.PLEDGED}async function af(a,b,c){let d,e=await fetch(_,{method:"POST",headers:{"Content-Type":"text/xml; charset=utf-8",SOAPAction:a},body:(d=c?`<soap:Header><sessionId xmlns="etapestryAPI/service" xsi:type="xsd:string">${ad(c)}</sessionId></soap:Header>`:"<soap:Header/>",`<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="etapestryAPI/service">
  ${d}
  <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
    ${b}
  </soap:Body>
</soap:Envelope>`)}),f=await e.text();if(!e.ok)throw new ac(`SOAP ${a} failed with status ${e.status}`,e.status,f);return function(a){let b=$.parse(a),c=b["soap:Envelope"]??b["env:Envelope"]??b.Envelope;if(!c)throw Error("Invalid SOAP response: missing envelope");let d=c["soap:Body"]??c["env:Body"]??c.Body;if(!d)throw Error("Invalid SOAP response: missing body");let e=d["soap:Fault"]??d["env:Fault"]??d.Fault;if(e){let b=new ab(e.faultstring??"SOAP fault");throw b.faultCode=e.faultcode,b.detail=e.detail,b.raw=a,b}return d}(f)}function ag(a,b){let c=b.endsWith("Response")?b:`${b}Response`;for(let[b,d]of Object.entries(a))if((b.includes(":")?b.split(":").pop()??b:b)===c)return d;return a}async function ah(){return aa||(aa=ai()),aa}async function ai(){try{let a=`<tns:connect>
  <ConnectRequest_1 xsi:type="tns:ConnectRequest">
    <applicationContext xmlns="" xsi:type="xsd:string">${ad(S.env.ETAPESTRY_APPLICATION_CONTEXT)}</applicationContext>
    <databaseId xmlns="" xsi:type="xsd:string">${ad(S.env.ETAPESTRY_DATABASE_ID)}</databaseId>
    <password xmlns="" xsi:type="xsd:string">${ad(S.env.ETAPESTRY_API_KEY)}</password>
  </ConnectRequest_1>
</tns:connect>`,b=await af("connect",a),c=ag(b,"connectResponse"),d=function a(b){if(null!=b){if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return String(b);if(Array.isArray(b)){for(let c of b){let b=a(c);if(b)return b}return}if("object"==typeof b)for(let c of Object.values(b)){let b=a(c);if(b)return b}}}(c);if(!d)throw Error("eTapestry connect did not return a session id.");return d}catch(a){throw aa=null,console.error("Failed to authenticate with eTapestry",a),a}}async function aj(a,b){let c=await ah(),d=`${S.env.ETAPESTRY_QUERY_CATEGORY}:${S.env.ETAPESTRY_QUERY_NAME}`,e=`<tns:getExistingQueryResults>
  <PagedExistingQueryResultsRequest_1 xsi:type="tns:PagedExistingQueryResultsRequest">
    <clearCache xmlns="" xsi:type="xsd:boolean">false</clearCache>
    <count xmlns="" xsi:type="xsd:int">${b}</count>
    <start xmlns="" xsi:type="xsd:int">${a}</start>
    <accountType xmlns="" xsi:type="xsd:int">0</accountType>
    <query xmlns="" xsi:type="xsd:string">${ad(d)}</query>
    <sortOptions xmlns="" xsi:nil="true" />
  </PagedExistingQueryResultsRequest_1>
</tns:getExistingQueryResults>`;try{let a=await af("getExistingQueryResults",e,c),b=ag(a,"getExistingQueryResultsResponse"),d=b?.result??b;if(!d||"object"!=typeof d)return[];return function a(b){if(!b)return[];if(Array.isArray(b))return b.filter(a=>"object"==typeof a&&null!==a);if("object"!=typeof b)return[];let c=function(a){let b={};for(let[c,d]of Object.entries(a)){let a=c.includes(":")?c.split(":").pop()??c:c;if(void 0===b[a])b[a]=d;else{let c=b[a];Array.isArray(c)?b[a]=c.concat(d):b[a]=[c,d]}}return b}(b);for(let b of["queryResults","rows","row","return","value","results","data","collection","item","items"]){let d=c[b];if(Array.isArray(d))return d.filter(a=>"object"==typeof a&&null!==a);if(d&&"object"==typeof d){let b=a(d);if(b.length)return b}}return[]}(d)}catch(a){throw a instanceof ab&&a.faultCode?.toLowerCase().includes("session")&&(aa=null),a}}function ak(a){if(null!=a){if("string"==typeof a||"number"==typeof a)return String(a);if("object"==typeof a&&null!==a&&"value"in a)return ak(a.value)}}function al(a,b){let c=b.map(a=>a.toLowerCase());for(let[b,d]of Object.entries(a))if(c.includes(b.toLowerCase())){let a=ak(d);if(a)return a}for(let b of[a.fieldValues,a.values])for(let a of function(a){if(!a)return[];if(Array.isArray(a))return a;if("object"==typeof a&&null!==a){if("fieldValue"in a&&Array.isArray(a.fieldValue))return a.fieldValue;if("value"in a&&Array.isArray(a.value))return a.value}return[]}(b)){let b=a.name??a.fieldName;if(b&&c.includes(b.toLowerCase())){let b=ak(a.value);if(b)return b}}}function am(a){if(!a)return;let b=new Date(a);if(!Number.isNaN(b.getTime()))return b}async function an(a){let b=0,c=[];for(;b<5e3;){let a=await aj(b,500),d=a.map(a=>(function(a){let b=al(a,["id","pledgeid","ref","accountref"]),c=function(a){if(!a)return;let b=Number(a.replace(/[^0-9.-]/g,""));return Number.isNaN(b)?void 0:b}(al(a,["amount","pledgeamount","giftamount"])),d=am(al(a,["date","pledgedate","giftdate","entrydate"]));if(!b||null==c||!d)return null;let e=al(a,["donorname","name","accountname"])??"BHIC donor",f=al(a,["donorid","accountnumber","constituentid"]),g=al(a,["email","emailaddress","primaryemail"]),h=al(a,["phone","phonenumber"]),i=am(al(a,["lastgiftdate","lastgivingdate"])),j=al(a,["campaign","fund","appeal"]),k=al(a,["status","pledgestatus"]);return{id:b,amount:c,date:d.toISOString(),campaign:j??void 0,status:k??void 0,donor:{externalId:f??void 0,name:e,email:g??void 0,phone:h??void 0,lastGiftDate:i?i.toISOString():void 0}}})(a)).filter(a=>!!a);if(c.push(...d),a.length<500)break;b+=500}return c.filter(b=>{let c=new Date(b.date);return c>=a.from&&c<=a.to})}async function ao(a){let b,e=(b=new Date,{from:a?.from??(0,d.subDays)(b,90),to:a?.to??b}),f=await an(e);for(let a of f){let b=a.donor.externalId??a.donor.id??`etp-${a.donor.email??a.id}`,c=await T.prisma.donor.upsert({where:{externalId:b},update:{name:a.donor.name,email:a.donor.email,phone:a.donor.phone},create:{externalId:b,name:a.donor.name,email:a.donor.email,phone:a.donor.phone}});await T.prisma.pledge.upsert({where:{externalId:a.id},update:{donorId:c.id,amount:a.amount,date:new Date(a.date),campaign:a.campaign,status:ae(a.status)},create:{externalId:a.id,donorId:c.id,amount:a.amount,date:new Date(a.date),campaign:a.campaign,status:ae(a.status)}})}await ap();let g={synced:f.length};return await X([c.MetricSource.ETAPESTRY]),await V(c.MetricSource.ETAPESTRY,g),g}async function ap(){let a=await T.prisma.pledge.groupBy({by:["donorId"],_sum:{amount:!0}}),b=new Map((await T.prisma.pledge.groupBy({by:["donorId"],where:{status:c.PledgeStatus.RECEIVED},_sum:{amount:!0}})).map(a=>[a.donorId,a._sum.amount??new c.Prisma.Decimal(0)])),d=await T.prisma.pledge.findMany({where:{status:c.PledgeStatus.RECEIVED},select:{donorId:!0,date:!0},orderBy:{date:"desc"}}),e=new Map;for(let a of d)e.has(a.donorId)||e.set(a.donorId,a.date);for(let d of a)await T.prisma.donor.update({where:{id:d.donorId},data:{totalPledged:d._sum.amount??new c.Prisma.Decimal(0),totalGiven:b.get(d.donorId)??new c.Prisma.Decimal(0),lastGiftDate:e.get(d.donorId)}})}async function aq(a){return(0,R.withMetricCache)({key:`funds:${a.from.toISOString()}:${a.to.toISOString()}`,from:a.from,to:a.to,source:c.MetricSource.ETAPESTRY,fetcher:async()=>{let b=await T.prisma.pledge.findMany({where:{date:{gte:a.from,lte:a.to}},select:{amount:!0,date:!0}}),c=(0,Y.getMonthlyBuckets)(12,a.to).map(a=>{let c=b.filter(b=>b.date>=a.start&&b.date<=a.end).reduce((a,b)=>a+Number(b.amount),0);return{label:a.label,total:c}});return{total:b.reduce((a,b)=>a+Number(b.amount),0),monthly:c}}})}a.s(["getFundsRaisedSummary",()=>aq,"syncPledgesToDb",()=>ao],71148);var ar=a.i(10236);let as="https://www.eventbriteapi.com/v3";function at(){return{Authorization:`Bearer ${S.env.EVENTBRITE_API_TOKEN}`,"Content-Type":"application/json"}}function au(a){switch(a?.toLowerCase()){case"live":return c.EventStatus.PUBLISHED;case"completed":return c.EventStatus.COMPLETED;case"canceled":return c.EventStatus.CANCELLED;default:return c.EventStatus.DRAFT}}async function av(a){let b,c=[],d=1;for(;;){let e=new URL(`/events/${a}/attendees/`,as);e.searchParams.set("status","attending"),e.searchParams.set("expand","profile"),b?e.searchParams.set("continuation",b):e.searchParams.set("page",String(d));let f=await fetch(e,{headers:at(),cache:"no-store"});if(!f.ok)throw Error(`Failed to fetch attendees for ${a}: ${f.statusText}`);let g=await f.json();c.push(...g.attendees??[]);let h=g.pagination;if(h?.has_more_items)h.continuation?b=h.continuation:(b=void 0,d+=1);else break}return c}async function aw(a){let b,c=[],d=1;for(;;){let e=new URL(`/organizations/${S.env.EVENTBRITE_ORGANIZATION_ID}/events/`,as);e.searchParams.set("order_by","start_desc"),e.searchParams.set("time_filter","custom"),e.searchParams.set("start_date.range_start",a.from.toISOString()),e.searchParams.set("start_date.range_end",a.to.toISOString()),e.searchParams.set("expand","ticket_availability,venue"),e.searchParams.set("page_size","50"),b?e.searchParams.set("continuation",b):e.searchParams.set("page",String(d));let f=await fetch(e,{headers:at(),cache:"no-store"});if(!f.ok)throw Error(`Failed to fetch Eventbrite events: ${f.statusText}`);let g=await f.json();c.push(...g.events??[]);let h=g.pagination;if(h?.has_more_items)h.continuation?b=h.continuation:(b=void 0,d+=1);else break}return await Promise.all(c.map(async a=>({...a,attendees:await av(a.id)})))}async function ax(a){let b,e=(b=new Date,{from:a?.from??(0,d.subDays)(b,120),to:a?.to??(0,ar.addDays)(b,30)}),f=await aw(e);for(let a of f){let b=await T.prisma.event.upsert({where:{externalId:a.id},update:{name:a.name?.text??"Untitled Event",startDate:new Date(a.start.utc),endDate:new Date(a.end.utc??a.start.utc),venue:a.venue?.name,status:au(a.status),ticketsTotal:a.ticket_availability?.capacity??0},create:{externalId:a.id,name:a.name?.text??"Untitled Event",startDate:new Date(a.start.utc),endDate:new Date(a.end.utc??a.start.utc),venue:a.venue?.name,status:au(a.status),ticketsTotal:a.ticket_availability?.capacity??0}});await T.prisma.eventAttendance.deleteMany({where:{eventId:b.id}});let c=0,d=0,e=[];for(let f of a.attendees){let a=f.profile?.email;if(!a)continue;let g=f.quantity??1,h=Number(f.cost?.major_value??0);c+=g,d+=h;let i=await T.prisma.donor.findUnique({where:{email:a}});e.push({eventId:b.id,donorId:i?.id??null,attendeeEmail:a,ticketType:f.ticket_class_name??"General",ticketsCount:g,orderTotal:h})}e.length&&await T.prisma.eventAttendance.createMany({data:e}),await T.prisma.event.update({where:{id:b.id},data:{ticketsSold:c,grossRevenue:d,netRevenue:.88*d}})}let g={synced:f.length};return await X([c.MetricSource.EVENTBRITE]),await V(c.MetricSource.EVENTBRITE,g),g}async function ay(a){return(0,R.withMetricCache)({key:`events:${a.from.toISOString()}:${a.to.toISOString()}`,from:a.from,to:a.to,source:c.MetricSource.EVENTBRITE,fetcher:async()=>{let b=await T.prisma.event.findMany({where:{startDate:{gte:a.from,lte:a.to}}}),c=b.length,d=b.reduce((a,b)=>a+b.ticketsSold,0);return{eventsCount:c,ticketsSold:d,grossRevenue:b.reduce((a,b)=>a+Number(b.grossRevenue),0),netRevenue:b.reduce((a,b)=>a+Number(b.netRevenue),0)}}})}a.s(["getEventKpis",()=>ay,"syncEventsToDb",()=>ax],40826)}];

//# sourceMappingURL=src_lib_etapestry_ts_142ac130._.js.map