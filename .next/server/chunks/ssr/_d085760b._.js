module.exports=[95805,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setDate(1),d.setHours(0,0,0,0),d}a.s(["startOfMonth",()=>c])},98794,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in),e=d.getMonth();return d.setFullYear(d.getFullYear(),e+1,0),d.setHours(23,59,59,999),d}a.s(["endOfMonth",()=>c])},7950,a=>{"use strict";var b=a.i(18956),c=a.i(99602);function d(a,d,e){return function(a,d,e){let f=(0,c.toDate)(a,e?.in);if(isNaN(d))return(0,b.constructFrom)(e?.in||a,NaN);if(!d)return f;let g=f.getDate(),h=(0,b.constructFrom)(e?.in||a,f.getTime());return(h.setMonth(f.getMonth()+d+1,0),g>=h.getDate())?h:(f.setFullYear(h.getFullYear(),h.getMonth(),g),f)}(a,-d,e)}a.s(["subMonths",()=>d],7950)},65314,a=>{"use strict";var b=a.i(12208),c=a.i(95805),d=a.i(98794),e=a.i(7950);function f(a=12,g=new Date){let h=[],i=(0,c.startOfMonth)(g);for(let c=a-1;c>=0;c-=1){let a=(0,e.subMonths)(i,c);h.push({key:(0,b.format)(a,"yyyy-MM"),label:(0,b.format)(a,"MMM yy"),start:a,end:(0,d.endOfMonth)(a)})}return h}a.s(["getMonthlyBuckets",()=>f])},31290,96818,18956,99602,10236,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}function e(a,b,e){let f=d(a,e?.in);return isNaN(b)?c(e?.in||a,NaN):(b&&f.setDate(f.getDate()+b),f)}function f(a,b,c){return e(a,-b,c)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInMinute",0,6e4,"millisecondsInWeek",0,6048e5],96818),a.s(["constructFrom",()=>c],18956),a.s(["toDate",()=>d],99602),a.s(["addDays",()=>e],10236),a.s(["subDays",()=>f],31290)},48461,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(0,0,0,0),d}a.s(["startOfDay",()=>c])},28954,a=>{"use strict";var b=a.i(96818),c=a.i(99602),d=a.i(66518);let e=!1;async function f({key:a,from:f,to:g,source:h,ttlMinutes:i=60,fetcher:j}){if(e)return j();try{var k,l,m;let e,n=await d.prisma.cachedMetric.findFirst({where:{key:a},orderBy:{createdAt:"desc"}});if(n&&(k=new Date,l=n.createdAt,e=((0,c.toDate)(k)-(0,c.toDate)(l))/b.millisecondsInMinute,(m=void 0,a=>{let b=(m?Math[m]:Math.trunc)(a);return 0===b?0:b})(e)<i))return n.value;let o=await j();return await d.prisma.cachedMetric.create({data:{key:a,value:o,fromDate:f,toDate:g,source:h}}).catch(a=>{console.warn("Failed to persist cached metric",a instanceof Error?a.message:a)}),o}catch(a){return e=!0,console.warn("Metric cache unavailable, falling back to live fetch",a instanceof Error?a.message:a),j()}}a.s(["withMetricCache",()=>f],28954)},97405,a=>{"use strict";var b=a.i(37936),c=a.i(29173),d=a.i(20971),e=a.i(18558),f=a.i(9307),g=a.i(71148),h=a.i(40826),i=a.i(14355);async function j(){let a=await (0,d.getServerSession)(f.authOptions);if(!a)throw Error("Authentication required");if("ADMIN"!==a.user.role)throw Error("Admin access required");let b={etapestry:null,eventbrite:null},j=[];try{b.etapestry=await (0,g.syncPledgesToDb)()}catch(b){let a=b instanceof Error?b.message:"Unknown eTapestry error";j.push(`eTapestry: ${a}`),await (0,i.recordIntegrationSync)(c.MetricSource.ETAPESTRY,{error:a})}try{b.eventbrite=await (0,h.syncEventsToDb)()}catch(b){let a=b instanceof Error?b.message:"Unknown Eventbrite error";j.push(`Eventbrite: ${a}`),await (0,i.recordIntegrationSync)(c.MetricSource.EVENTBRITE,{error:a})}return((0,e.revalidatePath)("/"),(0,e.revalidatePath)("/events"),(0,e.revalidatePath)("/donors"),j.length)?{success:!1,errors:j,result:b}:{success:!0,result:b}}(0,a.i(13095).ensureServerEntryExports)([j]),(0,b.registerServerReference)(j,"0079642c756b10993ed74226cd177e619c7bf8b6b7",null),a.s([],91279),a.i(91279),a.s(["0079642c756b10993ed74226cd177e619c7bf8b6b7",()=>j],97405)}];

//# sourceMappingURL=_d085760b._.js.map