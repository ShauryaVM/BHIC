{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts","../../../../src/app/%28dashboard%29/range-selector.tsx","../../../../src/app/%28dashboard%29/_components/integration-sync-panel.tsx","../../../../src/app/%28dashboard%29/actions/data%3Ae2dd1f%20%3Ctext/javascript%3E","../../../../src/app/%28dashboard%29/_components/manual-import-form.tsx","../../../../src/app/%28dashboard%29/actions/data%3A61febb%20%3Ctext/javascript%3E","../../../../src/app/%28dashboard%29/actions/manual-import-shared.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n","\"use client\";\r\n\r\nimport { usePathname, useRouter, useSearchParams } from 'next/navigation';\r\n\r\nimport { Button } from '@/components/ui/button';\r\n\r\nconst ranges = [\r\n  { value: 'ytd', label: 'Year to date' },\r\n  { value: '12m', label: 'Last 12 months' }\r\n];\r\n\r\ninterface Props {\r\n  currentRange: 'ytd' | '12m';\r\n}\r\n\r\nexport function DashboardRangeSelector({ currentRange }: Props) {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const searchParams = useSearchParams();\r\n\r\n  function updateRange(value: string) {\r\n    const params = new URLSearchParams(searchParams.toString());\r\n    params.set('range', value);\r\n    router.replace(`${pathname}?${params.toString()}`);\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 rounded-2xl border border-slate-200 bg-white p-1\">\r\n      {ranges.map((range) => (\r\n        <Button\r\n          key={range.value}\r\n          type=\"button\"\r\n          variant={range.value === currentRange ? 'primary' : 'ghost'}\r\n          size=\"sm\"\r\n          className=\"rounded-xl\"\r\n          onClick={() => updateRange(range.value)}\r\n        >\r\n          {range.label}\r\n        </Button>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n","\"use client\";\r\n\r\nimport { useState, useTransition } from 'react';\r\n\r\nimport { Button } from '@/components/ui/button';\r\nimport { IntegrationStatuses } from '@/lib/integration-sync';\r\nimport { syncIntegrationsAction } from '@/app/(dashboard)/actions/sync-integrations';\r\n\r\ninterface IntegrationSyncPanelProps {\r\n  statuses: IntegrationStatuses;\r\n}\r\n\r\nexport function IntegrationSyncPanel({ statuses }: IntegrationSyncPanelProps) {\r\n  const [pending, startTransition] = useTransition();\r\n  const [message, setMessage] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [latest, setLatest] = useState(statuses);\r\n\r\n  function formatTimestamp(timestamp?: string | null) {\r\n    if (!timestamp) return \"Never synced\";\r\n    const date = new Date(timestamp);\r\n    if (Number.isNaN(date.getTime())) return \"Unknown\";\r\n    return date.toLocaleString();\r\n  }\r\n\r\n  function formatStatus(status: IntegrationStatuses[\"etapestry\"]) {\r\n    if (!status) {\r\n      return \"Never synced\";\r\n    }\r\n    if (status.error) {\r\n      return `Failed · ${status.error}`;\r\n    }\r\n    return `Last synced ${formatTimestamp(status.timestamp)} · ${status.synced ?? 0} records`;\r\n  }\r\n\r\n  function handleSync() {\r\n    setMessage(null);\r\n    setError(null);\r\n    startTransition(async () => {\r\n      try {\r\n        const result = await syncIntegrationsAction();\r\n        if (!result.success) {\r\n          setError(result.errors?.join(' ') ?? 'Unable to sync data.');\r\n          return;\r\n        }\r\n        const timestamp = new Date().toISOString();\r\n        setLatest({\r\n          etapestry: {\r\n            synced: result.result.etapestry?.synced,\r\n            timestamp\r\n          },\r\n          eventbrite: {\r\n            synced: result.result.eventbrite?.synced,\r\n            timestamp\r\n          }\r\n        });\r\n        setMessage(\r\n          `eTapestry synced ${result.result.etapestry?.synced ?? 0} pledges · Eventbrite synced ${\r\n            result.result.eventbrite?.synced ?? 0\r\n          } events.`\r\n        );\r\n      } catch (err) {\r\n        console.error(err);\r\n        setError(err instanceof Error ? err.message : 'Failed to sync data.');\r\n      }\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"grid gap-4 text-sm md:grid-cols-2\">\r\n        <div className=\"rounded-2xl border border-slate-200 p-4\">\r\n          <p className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">eTapestry</p>\r\n          <p className=\"mt-1 text-sm text-slate-700\">{formatStatus(latest.etapestry)}</p>\r\n        </div>\r\n        <div className=\"rounded-2xl border border-slate-200 p-4\">\r\n          <p className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">Eventbrite</p>\r\n          <p className=\"mt-1 text-sm text-slate-700\">{formatStatus(latest.eventbrite)}</p>\r\n        </div>\r\n      </div>\r\n      <Button type=\"button\" variant=\"primary\" onClick={handleSync} disabled={pending}>\r\n        {pending ? \"Syncing data...\" : \"Sync data sources\"}\r\n      </Button>\r\n      {message ? <p className=\"text-xs text-green-600\">{message}</p> : null}\r\n      {error ? <p className=\"text-xs text-red-500\">{error}</p> : null}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","/* __next_internal_action_entry_do_not_use__ [{\"00510e1a30a37162808b9089fdbe2d7b1a8b0d49d9\":\"syncIntegrationsAction\"},\"src/app/(dashboard)/actions/sync-integrations.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var syncIntegrationsAction=/*#__PURE__*/createServerReference(\"00510e1a30a37162808b9089fdbe2d7b1a8b0d49d9\",callServer,void 0,findSourceMapURL,\"syncIntegrationsAction\");","\"use client\";\r\n\r\nimport { useActionState, useId } from 'react';\r\n\r\nimport { manualImportAction } from '@/app/(dashboard)/actions/manual-import';\r\nimport { manualImportInitialState } from '@/app/(dashboard)/actions/manual-import-shared';\r\nimport { Button } from '@/components/ui/button';\r\n\r\ninterface ManualImportFormProps {\r\n  source: 'etapestry' | 'eventbrite';\r\n  label: string;\r\n}\r\n\r\nexport function ManualImportForm({ source, label }: ManualImportFormProps) {\r\n  const [state, formAction, pending] = useActionState(manualImportAction, manualImportInitialState);\r\n  const id = useId();\r\n\r\n  return (\r\n    <form action={formAction} encType=\"multipart/form-data\" className=\"space-y-3\">\r\n      <input type=\"hidden\" name=\"source\" value={source} />\r\n      <div className=\"space-y-1.5\">\r\n        <label htmlFor={`${id}-file`} className=\"text-sm font-medium text-slate-700\">\r\n          Upload CSV export\r\n        </label>\r\n        <input\r\n          id={`${id}-file`}\r\n          name=\"file\"\r\n          type=\"file\"\r\n          accept=\".csv\"\r\n          required\r\n          className=\"block w-full cursor-pointer rounded-xl border border-dashed border-slate-300 bg-white px-3 py-2 text-sm text-slate-600 file:mr-3 file:rounded-lg file:border-0 file:bg-slate-900 file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-white\"\r\n        />\r\n        <p className=\"text-xs text-slate-500\">Only CSV files using the provided template are accepted.</p>\r\n      </div>\r\n      <Button type=\"submit\" variant=\"primary\" disabled={pending}>\r\n        {pending ? 'Importing…' : `Import ${label}`}\r\n      </Button>\r\n      {state.message ? (\r\n        <p className={`text-sm ${state.success ? 'text-green-600' : 'text-red-600'}`}>{state.message}</p>\r\n      ) : null}\r\n    </form>\r\n  );\r\n}\r\n\r\n","/* __next_internal_action_entry_do_not_use__ [{\"602bb404ace8a7318c768fbd08f61eaa16a4c0149a\":\"manualImportAction\"},\"src/app/(dashboard)/actions/manual-import.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var manualImportAction=/*#__PURE__*/createServerReference(\"602bb404ace8a7318c768fbd08f61eaa16a4c0149a\",callServer,void 0,findSourceMapURL,\"manualImportAction\");","export type ManualImportResult = {\r\n  success: boolean;\r\n  message: string;\r\n  errors?: string[];\r\n};\r\n\r\nexport const manualImportInitialState: ManualImportResult = {\r\n  success: false,\r\n  message: ''\r\n};\r\n\r\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"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","ignoreList":[0]}